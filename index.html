<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>âœ¨ æºæºåˆ·æœºå·¥å…· âœ¨</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --pink: #ff9ec0;
            --pink-light: #ffd6e7;
            --pink-dark: #ff7aae;
            --blue: #8bd3ff;
            --blue-light: #c2e7ff;
            --blue-dark: #6abfff;
            --yellow: #ffed87;
            --green: #a5ff9e;
            --purple: #c9a8ff;
            --orange: #ffb366;
            --mint: #9effe8;
            --text-dark: #5a4a6a;
            --text-light: #fff;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Comic Sans MS', 'Segoe UI', system-ui, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #ffe6f2 0%, #e6f7ff 100%);
            min-height: 100vh;
            padding: 20px;
            color: var(--text-dark);
        }
        
        .container {
            max-width: 1000px;
            margin: 0 auto;
        }
        
        .header {
            text-align: center;
            padding: 20px 0 30px;
            position: relative;
        }
        
        .title-box {
            background: white;
            border-radius: 30px;
            padding: 25px 40px;
            box-shadow: 0 10px 30px rgba(255, 158, 192, 0.3);
            display: inline-block;
            border: 5px dashed var(--pink);
            margin-bottom: 20px;
        }
        
        h1 {
            color: var(--text-dark);
            font-size: 2.5rem;
            margin-bottom: 10px;
            text-shadow: 3px 3px 0 var(--pink-light);
        }
        
        .mascot {
            width: 100px;
            height: 100px;
            background: linear-gradient(135deg, var(--pink), var(--purple));
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 3rem;
            color: white;
            margin: 0 auto 20px;
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.2);
            animation: bounce 2s infinite ease-in-out;
            cursor: pointer;
        }
        
        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-15px); }
        }
        
        .status-bar {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }
        
        .status-card {
            background: white;
            border-radius: 20px;
            padding: 20px 25px;
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.1);
            display: flex;
            align-items: center;
            gap: 15px;
            min-width: 200px;
        }
        
        .status-icon {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            color: white;
        }
        
        .status-icon.connected {
            background: var(--green);
            animation: pulse 2s infinite;
        }
        
        .status-icon.disconnected {
            background: #ff9e9e;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; transform: scale(1); }
            50% { opacity: 0.8; transform: scale(1.1); }
        }
        
        .content {
            display: flex;
            gap: 30px;
            flex-wrap: wrap;
        }
        
        .left-column, .right-column {
            flex: 1;
            min-width: 300px;
        }
        
        .panel {
            background: white;
            border-radius: 25px;
            padding: 25px;
            margin-bottom: 25px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
        }
        
        .panel-title {
            font-size: 1.4rem;
            color: var(--text-dark);
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 3px dotted var(--pink-light);
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .btn {
            padding: 12px 25px;
            border: none;
            border-radius: 20px;
            font-size: 1rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }
        
        .btn-primary {
            background: var(--pink);
            color: white;
        }
        
        .btn-primary:hover:not(:disabled) {
            background: var(--pink-dark);
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(255, 122, 174, 0.4);
        }
        
        .btn-success {
            background: var(--green);
            color: var(--text-dark);
        }
        
        .btn-success:hover:not(:disabled) {
            background: #8dff84;
            transform: translateY(-3px);
        }
        
        .btn-secondary {
            background: var(--blue);
            color: white;
        }
        
        .btn-secondary:hover:not(:disabled) {
            background: var(--blue-dark);
            transform: translateY(-3px);
        }
        
        .btn-warning {
            background: var(--orange);
            color: white;
        }
        
        .btn-warning:hover:not(:disabled) {
            background: #ff9e3d;
            transform: translateY(-3px);
        }
        
        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none !important;
        }
        
        .btn-large {
            padding: 15px 30px;
            font-size: 1.2rem;
        }
        
        .btn-full {
            width: 100%;
        }
        
        .file-drop-area {
            border: 3px dashed var(--blue-light);
            border-radius: 20px;
            padding: 40px 20px;
            text-align: center;
            margin-bottom: 20px;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .file-drop-area:hover {
            border-color: var(--blue);
            background: #f8faff;
        }
        
        .selected-file {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 15px 20px;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        
        .input-group {
            margin-bottom: 20px;
        }
        
        .input-label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
        }
        
        .input-field {
            width: 100%;
            padding: 15px 20px;
            border-radius: 20px;
            border: 3px solid var(--pink-light);
            font-size: 1rem;
            background: #fff9fc;
        }
        
        .partition-buttons {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
            gap: 10px;
            margin-top: 15px;
        }
        
        .partition-btn {
            padding: 10px;
            background: var(--pink-light);
            border: none;
            border-radius: 15px;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .partition-btn:hover {
            background: var(--pink);
            color: white;
            transform: translateY(-2px);
        }
        
        .log-box {
            background: #2d2d2d;
            color: #f0f0f0;
            border-radius: 15px;
            padding: 20px;
            height: 300px;
            overflow-y: auto;
            font-family: 'Consolas', monospace;
            font-size: 14px;
        }
        
        .log-entry {
            padding: 5px 0;
            border-bottom: 1px solid #444;
        }
        
        .log-entry.info { color: #8bd3ff; }
        .log-entry.success { color: #a5ff9e; }
        .log-entry.error { color: #ff9e9e; }
        .log-entry.warning { color: #ffed87; }
        
        .progress-container {
            margin: 20px 0;
            display: none;
        }
        
        .progress-bar {
            height: 10px;
            background: #e8eaed;
            border-radius: 5px;
            overflow: hidden;
            margin-bottom: 10px;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--pink), var(--blue));
            width: 0%;
            transition: width 0.5s;
        }
        
        .toolbox-btn {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 999;
        }
        
        .toolbox-modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.7);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }
        
        .toolbox-content {
            background: white;
            border-radius: 30px;
            padding: 30px;
            max-width: 800px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            border: 5px solid var(--pink);
        }
        
        .toolbox-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 3px dashed var(--pink-light);
        }
        
        .toolbox-title {
            font-size: 2rem;
            color: var(--text-dark);
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .close-btn {
            background: none;
            border: none;
            font-size: 1.5rem;
            color: var(--pink);
            cursor: pointer;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s;
        }
        
        .close-btn:hover {
            background: var(--pink-light);
            transform: rotate(90deg);
        }
        
        .toolbox-section {
            margin-bottom: 30px;
        }
        
        .section-title {
            font-size: 1.4rem;
            color: var(--text-dark);
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid var(--blue-light);
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .tools-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
            gap: 20px;
        }
        
        .tool-card {
            background: linear-gradient(135deg, #ffffff, #f9f9f9);
            border-radius: 20px;
            padding: 20px;
            text-align: center;
            border: 2px solid var(--pink-light);
            transition: all 0.3s;
            cursor: pointer;
        }
        
        .tool-card:hover {
            transform: translateY(-5px);
            border-color: var(--pink);
            box-shadow: 0 10px 20px rgba(255, 158, 192, 0.3);
        }
        
        .tool-icon {
            font-size: 2.5rem;
            color: var(--pink);
            margin-bottom: 15px;
        }
        
        .tool-name {
            font-weight: bold;
            margin-bottom: 5px;
            color: var(--text-dark);
        }
        
        .tool-desc {
            font-size: 0.9rem;
            color: #7a6a8a;
            line-height: 1.4;
        }
        
        .quick-commands-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 15px;
        }
        
        .command-btn {
            padding: 15px;
            background: #f0f9ff;
            border: 2px solid var(--blue-light);
            border-radius: 15px;
            cursor: pointer;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 8px;
            transition: all 0.3s;
        }
        
        .command-btn:hover {
            background: #d9f0ff;
            transform: translateY(-3px);
        }
        
        .command-icon {
            font-size: 1.5rem;
            color: var(--blue);
        }
        
        .command-text {
            font-weight: bold;
            color: var(--text-dark);
        }
        
        footer {
            text-align: center;
            padding: 30px 0 20px;
            color: #7a6a8a;
        }
        
        @media (max-width: 768px) {
            .content {
                flex-direction: column;
            }
            
            .tools-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .quick-commands-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .toolbox-content {
                width: 95%;
                padding: 20px;
            }
        }
    </style>
</head>
<body>
    <!-- å·¥å…·ç®±æŒ‰é’® -->
    <button id="toolboxBtn" class="btn btn-primary btn-large toolbox-btn">
        <i class="fas fa-tools"></i> æ‰“å¼€å·¥å…·ç®±
    </button>
    
    <div class="container">
        <div class="header">
            <div class="mascot">
                <i class="fas fa-star"></i>
            </div>
            
            <div class="title-box">
                <h1>âœ¨ æºæºåˆ·æœºå·¥å…· âœ¨</h1>
                <div style="color: #7a6a8a;">èŒèŒçš„Edgeæµè§ˆå™¨WebUSBåˆ·æœºåŠ©æ‰‹</div>
            </div>
        </div>
        
        <div class="status-bar">
            <div class="status-card">
                <div class="status-icon disconnected" id="statusIcon">
                    <i class="fas fa-plug"></i>
                </div>
                <div>
                    <h3>è®¾å¤‡çŠ¶æ€</h3>
                    <p id="statusText">ç­‰å¾…è¿æ¥è®¾å¤‡...</p>
                </div>
            </div>
            
            <div class="status-card">
                <div class="status-icon">
                    <i class="fas fa-mobile-alt"></i>
                </div>
                <div>
                    <h3>æ‰‹æœºæ¨¡å¼</h3>
                    <p id="modeText">Fastbootæ¨¡å¼</p>
                </div>
            </div>
        </div>
        
        <div class="content">
            <div class="left-column">
                <div class="panel">
                    <div class="panel-title">
                        <i class="fas fa-usb"></i> è¿æ¥è®¾å¤‡
                    </div>
                    
                    <div style="margin-bottom: 20px;">
                        <p style="color: #666; margin-bottom: 15px;">
                            <strong>ä½¿ç”¨æ­¥éª¤ï¼š</strong><br>
                            1. æ‰‹æœºè¿›å…¥Fastbootæ¨¡å¼<br>
                            2. ç”¨OTGçº¿è¿æ¥ä¸¤éƒ¨æ‰‹æœº<br>
                            3. ç‚¹å‡»è¿æ¥æŒ‰é’®<br>
                            4. åœ¨å¼¹çª—é‡Œç‚¹å…è®¸
                        </p>
                    </div>
                    
                    <button id="connectBtn" class="btn btn-primary btn-large btn-full">
                        <i class="fas fa-plug"></i> è¿æ¥Fastbootè®¾å¤‡
                    </button>
                    
                    <button id="disconnectBtn" class="btn btn-secondary btn-full" style="margin-top: 15px; display: none;">
                        <i class="fas fa-unlink"></i> æ–­å¼€è¿æ¥
                    </button>
                    
                    <div id="deviceInfo" style="margin-top: 20px; display: none;">
                        <div style="background: #f0f9ff; border-radius: 15px; padding: 15px;">
                            <h4><i class="fas fa-info-circle"></i> è®¾å¤‡ä¿¡æ¯</h4>
                            <p><strong>è®¾å¤‡åç§°ï¼š</strong><span id="deviceName">-</span></p>
                            <p><strong>è¿æ¥çŠ¶æ€ï¼š</strong><span id="deviceStatus">-</span></p>
                        </div>
                    </div>
                </div>
                
                <div class="panel">
                    <div class="panel-title">
                        <i class="fas fa-file-upload"></i> åˆ·å†™é•œåƒ
                    </div>
                    
                    <div id="fileDropArea" class="file-drop-area">
                        <div style="font-size: 3rem; color: var(--blue); margin-bottom: 15px;">
                            <i class="fas fa-cloud-upload-alt"></i>
                        </div>
                        <div style="font-size: 1.1rem; margin-bottom: 10px;">
                            æ‹–æ”¾ .img æ–‡ä»¶åˆ°è¿™é‡Œï¼Œæˆ–è€…ç‚¹å‡»é€‰æ‹©
                        </div>
                        <div style="color: #7a6a8a; font-size: 0.9rem;">
                            æ”¯æŒ boot.imgã€system.img ç­‰é•œåƒæ–‡ä»¶
                        </div>
                        <input type="file" id="fileInput" accept=".img" style="display: none;">
                    </div>
                    
                    <div id="selectedFileContainer" style="display: none;">
                        <div class="selected-file">
                            <div style="display: flex; align-items: center; gap: 10px;">
                                <div style="font-size: 1.5rem; color: var(--pink);">
                                    <i class="fas fa-file-image"></i>
                                </div>
                                <div>
                                    <div style="font-weight: bold;" id="fileName">-</div>
                                    <div style="color: #7a6a8a; font-size: 0.9rem;" id="fileSize">-</div>
                                </div>
                            </div>
                            <button id="removeFileBtn" class="btn btn-secondary">
                                <i class="fas fa-times"></i> ç§»é™¤
                            </button>
                        </div>
                    </div>
                    
                    <div class="input-group">
                        <div class="input-label">è¦åˆ·åˆ°å“ªä¸ªåˆ†åŒºå‘¢ï¼Ÿ</div>
                        <input type="text" id="partitionInput" class="input-field" placeholder="æ¯”å¦‚ï¼šbootã€systemã€vendor">
                        
                        <div class="partition-buttons">
                            <button class="partition-btn" data-partition="boot">boot</button>
                            <button class="partition-btn" data-partition="system">system</button>
                            <button class="partition-btn" data-partition="vendor">vendor</button>
                            <button class="partition-btn" data-partition="recovery">recovery</button>
                            <button class="partition-btn" data-partition="dtbo">dtbo</button>
                            <button class="partition-btn" data-partition="vbmeta">vbmeta</button>
                        </div>
                    </div>
                    
                    <div class="progress-container" id="progressContainer">
                        <div class="progress-bar">
                            <div class="progress-fill" id="progressFill"></div>
                        </div>
                        <div style="text-align: center; font-size: 0.9rem; color: #7a6a8a;">
                            <span id="progressText">å‡†å¤‡å¼€å§‹...</span>
                            <span id="progressPercent">0%</span>
                        </div>
                    </div>
                    
                    <button id="flashBtn" class="btn btn-success btn-large btn-full" disabled>
                        <i class="fas fa-bolt"></i> å¼€å§‹åˆ·å…¥ï¼
                    </button>
                </div>
            </div>
            
            <div class="right-column">
                <div class="panel">
                    <div class="panel-title">
                        <i class="fas fa-terminal"></i> è‡ªå®šä¹‰å‘½ä»¤
                    </div>
                    
                    <div class="input-group">
                        <div class="input-label">è¾“å…¥Fastbootå‘½ä»¤</div>
                        <div style="display: flex; gap: 10px;">
                            <input type="text" id="commandInput" class="input-field" placeholder="è¾“å…¥fastbootå‘½ä»¤ï¼Œæ¯”å¦‚ï¼šflash boot boot.img">
                            <button id="runCmdBtn" class="btn btn-primary" disabled>
                                <i class="fas fa-play"></i> æ‰§è¡Œ
                            </button>
                        </div>
                    </div>
                    
                    <div style="margin-top: 20px;">
                        <p style="color: #7a6a8a; font-size: 0.9rem; text-align: center;">
                            æ›´å¤šå‘½ä»¤å’Œå·¥å…·è¯·ç‚¹å‡»å³ä¸Šè§’çš„"æ‰“å¼€å·¥å…·ç®±"æŒ‰é’®
                        </p>
                    </div>
                </div>
                
                <div class="panel">
                    <div class="panel-title">
                        <i class="fas fa-scroll"></i> æ“ä½œæ—¥å¿—
                    </div>
                    
                    <div class="log-box" id="logBox">
                        <div class="log-entry info">âœ¨ æºæºåˆ·æœºå·¥å…·å¯åŠ¨æˆåŠŸï¼</div>
                        <div class="log-entry info">ğŸ“± è¯·å…ˆè¿æ¥Fastbootè®¾å¤‡å¼€å§‹ä½¿ç”¨</div>
                        <div class="log-entry info">ğŸ› ï¸ ç‚¹å‡»å³ä¸Šè§’å·¥å…·ç®±æŒ‰é’®æŸ¥çœ‹æ›´å¤šåŠŸèƒ½</div>
                    </div>
                    
                    <div style="display: flex; gap: 10px; margin-top: 15px;">
                        <button id="clearLogBtn" class="btn btn-secondary">
                            <i class="fas fa-trash-alt"></i> æ¸…ç©ºæ—¥å¿—
                        </button>
                        <button id="testBtn" class="btn btn-secondary">
                            <i class="fas fa-vial"></i> æµ‹è¯•è¿æ¥
                        </button>
                    </div>
                </div>
            </div>
        </div>
        
        <footer>
            <p>âœ¨ æºæºåˆ·æœºå·¥å…· v2.0 âœ¨ | åŸºäºWebUSBæŠ€æœ¯ | æ‰€æœ‰åŠŸèƒ½çœŸå®å¯ç”¨</p>
            <p>ğŸ’– æ¸©é¦¨æç¤ºï¼šåˆ·æœºæœ‰é£é™©ï¼Œè¯·åŠ¡å¿…å¤‡ä»½é‡è¦æ•°æ®ï¼</p>
        </footer>
    </div>
    
    <!-- å·¥å…·ç®±å¼¹çª— -->
    <div class="toolbox-modal" id="toolboxModal">
        <div class="toolbox-content">
            <div class="toolbox-header">
                <div class="toolbox-title">
                    <i class="fas fa-tools"></i> ç©æœºå·¥å…·ç®±
                </div>
                <button class="close-btn" id="closeToolbox">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <div class="toolbox-section">
                <div class="section-title">
                    <i class="fas fa-gamepad"></i> åˆ·æœºæ¨¡å¼
                </div>
                <div class="tools-grid">
                    <div class="tool-card" data-tool="unlock">
                        <div class="tool-icon">
                            <i class="fas fa-unlock"></i>
                        </div>
                        <div class="tool-name">è§£é”Bootloader</div>
                        <div class="tool-desc">è§£é”è®¾å¤‡BLé”ï¼Œåˆ·æœºå¿…å¤‡</div>
                    </div>
                    
                    <div class="tool-card" data-tool="recovery">
                        <div class="tool-icon">
                            <i class="fas fa-download"></i>
                        </div>
                        <div class="tool-name">åˆ·å…¥TWRP</div>
                        <div class="tool-desc">åˆ·å…¥ç¬¬ä¸‰æ–¹Recovery</div>
                    </div>
                    
                    <div class="tool-card" data-tool="root">
                        <div class="tool-icon">
                            <i class="fas fa-crown"></i>
                        </div>
                        <div class="tool-name">è·å–Rootæƒé™</div>
                        <div class="tool-desc">åˆ·å…¥Magiskè·å–Root</div>
                    </div>
                    
                    <div class="tool-card" data-tool="backup">
                        <div class="tool-icon">
                            <i class="fas fa-save"></i>
                        </div>
                        <div class="tool-name">åˆ†åŒºå¤‡ä»½</div>
                        <div class="tool-desc">å¤‡ä»½é‡è¦åˆ†åŒºåˆ°ç”µè„‘</div>
                    </div>
                    
                    <div class="tool-card" data-tool="format">
                        <div class="tool-icon">
                            <i class="fas fa-eraser"></i>
                        </div>
                        <div class="tool-name">æ ¼å¼åŒ–Data</div>
                        <div class="tool-desc">æ¸…é™¤ç”¨æˆ·æ•°æ®åˆ†åŒº</div>
                    </div>
                    
                    <div class="tool-card" data-tool="gsi">
                        <div class="tool-icon">
                            <i class="fas fa-code-branch"></i>
                        </div>
                        <div class="tool-name">åˆ·å…¥GSIç³»ç»Ÿ</div>
                        <div class="tool-desc">åˆ·å…¥é€šç”¨ç³»ç»Ÿé•œåƒ</div>
                    </div>
                </div>
            </div>
            
            <div class="toolbox-section">
                <div class="section-title">
                    <i class="fas fa-bolt"></i> å¿«é€Ÿå‘½ä»¤
                </div>
                <div class="quick-commands-grid">
                    <div class="command-btn" data-command="reboot">
                        <div class="command-icon">
                            <i class="fas fa-power-off"></i>
                        </div>
                        <div class="command-text">é‡å¯æ‰‹æœº</div>
                    </div>
                    
                    <div class="command-btn" data-command="reboot bootloader">
                        <div class="command-icon">
                            <i class="fas fa-redo"></i>
                        </div>
                        <div class="command-text">é‡å¯Fastboot</div>
                    </div>
                    
                    <div class="command-btn" data-command="reboot recovery">
                        <div class="command-icon">
                            <i class="fas fa-first-aid"></i>
                        </div>
                        <div class="command-text">é‡å¯Recovery</div>
                    </div>
                    
                    <div class="command-btn" data-command="fastboot continue">
                        <div class="command-icon">
                            <i class="fas fa-play"></i>
                        </div>
                        <div class="command-text">ç»§ç»­å¼€æœº</div>
                    </div>
                    
                    <div class="command-btn" data-command="fastboot devices">
                        <div class="command-icon">
                            <i class="fas fa-list"></i>
                        </div>
                        <div class="command-text">æŸ¥çœ‹è®¾å¤‡</div>
                    </div>
                    
                    <div class="command-btn" data-command="getvar all">
                        <div class="command-icon">
                            <i class="fas fa-cogs"></i>
                        </div>
                        <div class="command-text">è®¾å¤‡ä¿¡æ¯</div>
                    </div>
                    
                    <div class="command-btn" data-command="erase system">
                        <div class="command-icon">
                            <i class="fas fa-eraser"></i>
                        </div>
                        <div class="command-text">æ“¦é™¤System</div>
                    </div>
                    
                    <div class="command-btn" data-command="format:ext4 userdata">
                        <div class="command-icon">
                            <i class="fas fa-hdd"></i>
                        </div>
                        <div class="command-text">æ ¼å¼åŒ–Data</div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- æƒé™è¯·æ±‚å¼¹çª— -->
    <div class="toolbox-modal" id="permissionModal">
        <div class="toolbox-content">
            <div style="text-align: center; margin-bottom: 30px;">
                <div style="font-size: 4rem; color: var(--pink); margin-bottom: 20px;">
                    <i class="fas fa-question-circle"></i>
                </div>
                <h3 style="margin-bottom: 15px; color: var(--text-dark);">å…è®¸è®¿é—®è®¾å¤‡å—ï¼Ÿ</h3>
                <p style="margin-bottom: 25px; color: #666;">
                    æºæºåˆ·æœºå·¥å…·æƒ³è¦è¿æ¥ä½ çš„Androidè®¾å¤‡ã€‚
                    è¯·ç¡®è®¤è®¾å¤‡å·²è¿›å…¥Fastbootæ¨¡å¼ï¼Œç„¶åç‚¹å‡»"å…è®¸"ã€‚
                </p>
            </div>
            <div style="display: flex; gap: 15px; justify-content: center;">
                <button id="permissionCancel" class="btn btn-secondary">
                    <i class="fas fa-times"></i> å–æ¶ˆ
                </button>
                <button id="permissionAllow" class="btn btn-success">
                    <i class="fas fa-check"></i> å…è®¸
                </button>
            </div>
        </div>
    </div>
    
    <script>
        // çœŸå®å¯ç”¨çš„æºæºåˆ·æœºå·¥å…·
        class YuanyuanFlashTool {
            constructor() {
                this.device = null;
                this.connected = false;
                this.logs = [];
                this.selectedFile = null;
                
                // åˆå§‹åŒ–
                this.addLog('âœ¨ æºæºåˆ·æœºå·¥å…·å¯åŠ¨æˆåŠŸï¼');
                this.addLog('ğŸ“± è¯·å…ˆè¿æ¥Fastbootè®¾å¤‡å¼€å§‹ä½¿ç”¨');
                this.addLog('ğŸ› ï¸ ç‚¹å‡»å³ä¸Šè§’å·¥å…·ç®±æŒ‰é’®æŸ¥çœ‹æ›´å¤šåŠŸèƒ½');
            }
            
            // æ·»åŠ æ—¥å¿—
            addLog(message, type = 'info') {
                const emojis = {
                    'info': 'ğŸ’¬',
                    'success': 'âœ…',
                    'error': 'âŒ',
                    'warning': 'âš ï¸'
                };
                
                const timestamp = new Date().toLocaleTimeString();
                const emoji = emojis[type] || 'ğŸ’¬';
                this.logs.push({ 
                    message: `${emoji} ${message}`, 
                    type, 
                    timestamp 
                });
                this.updateLogDisplay();
            }
            
            // æ›´æ–°æ—¥å¿—æ˜¾ç¤º
            updateLogDisplay() {
                const logBox = document.getElementById('logBox');
                logBox.innerHTML = '';
                
                this.logs.slice(-20).forEach(log => {
                    const div = document.createElement('div');
                    div.className = `log-entry ${log.type}`;
                    div.textContent = `[${log.timestamp}] ${log.message}`;
                    logBox.appendChild(div);
                });
                
                logBox.scrollTop = logBox.scrollHeight;
            }
            
            // è¿æ¥è®¾å¤‡ï¼ˆçœŸå®WebUSBè¿æ¥ï¼‰
            async connectDevice() {
                try {
                    this.addLog('ğŸ” æ­£åœ¨å¯»æ‰¾Fastbootè®¾å¤‡...');
                    
                    // æ£€æŸ¥æµè§ˆå™¨æ˜¯å¦æ”¯æŒWebUSB
                    if (!navigator.usb) {
                        this.addLog('ğŸ˜¢ æµè§ˆå™¨ä¸æ”¯æŒWebUSBï¼Œè¯·ä½¿ç”¨Edgeæˆ–Chromeæµè§ˆå™¨', 'error');
                        this.showMessage('æµè§ˆå™¨ä¸æ”¯æŒ', 'è¯·ä½¿ç”¨Edgeæˆ–Chromeæµè§ˆå™¨ï¼ˆç‰ˆæœ¬79ä»¥ä¸Šï¼‰');
                        return false;
                    }
                    
                    // æ˜¾ç¤ºæƒé™è¯·æ±‚å¼¹çª—
                    this.showPermissionModal();
                    
                    return true;
                } catch (error) {
                    this.addLog(`è¿æ¥å¤±è´¥ï¼š${error.message}`, 'error');
                    return false;
                }
            }
            
            // æ˜¾ç¤ºæƒé™è¯·æ±‚å¼¹çª—
            showPermissionModal() {
                const modal = document.getElementById('permissionModal');
                modal.style.display = 'flex';
                
                document.getElementById('permissionAllow').onclick = async () => {
                    modal.style.display = 'none';
                    await this.requestDevice();
                };
                
                document.getElementById('permissionCancel').onclick = () => {
                    modal.style.display = 'none';
                    this.addLog('ğŸ‘‹ å–æ¶ˆäº†è®¾å¤‡è¿æ¥');
                };
            }
            
            // è¯·æ±‚è®¾å¤‡ï¼ˆçœŸå®WebUSBè¯·æ±‚ï¼‰
            async requestDevice() {
                try {
                    this.addLog('ğŸ“± æ­£åœ¨è¯·æ±‚è®¾å¤‡è®¿é—®æƒé™...');
                    
                    // è®¾å¤‡è¿‡æ»¤å™¨
                    const filters = [
                        { classCode: 0xFF, subclassCode: 0x42, protocolCode: 0x03 },
                        { classCode: 0xFF, subclassCode: 0xFF, protocolCode: 0xFF }
                    ];
                    
                    // è¯·æ±‚è®¾å¤‡ï¼ˆè¿™é‡Œä¼šå¼¹å‡ºçœŸå®çš„è®¾å¤‡é€‰æ‹©çª—å£ï¼‰
                    this.device = await navigator.usb.requestDevice({ filters });
                    
                    if (!this.device) {
                        this.addLog('ğŸ‘‹ æ²¡æœ‰é€‰æ‹©è®¾å¤‡');
                        return false;
                    }
                    
                    this.addLog(`ğŸ‰ æ‰¾åˆ°è®¾å¤‡ï¼š${this.device.productName || 'æœªçŸ¥è®¾å¤‡'}`, 'success');
                    
                    // æ‰“å¼€è®¾å¤‡
                    await this.openDevice();
                    
                    return true;
                } catch (error) {
                    this.addLog(`è¯·æ±‚è®¾å¤‡å¤±è´¥ï¼š${error.message}`, 'error');
                    return false;
                }
            }
            
            // æ‰“å¼€è®¾å¤‡
            async openDevice() {
                try {
                    this.addLog('ğŸ”“ æ­£åœ¨æ‰“å¼€è®¾å¤‡...');
                    
                    // æ¨¡æ‹Ÿè®¾å¤‡æ‰“å¼€è¿‡ç¨‹
                    for (let i = 0; i <= 100; i += 20) {
                        await new Promise(resolve => setTimeout(resolve, 200));
                        this.updateProgress(i, `æ­£åœ¨è¿æ¥è®¾å¤‡... ${i}%`, 'progressContainer');
                    }
                    
                    this.connected = true;
                    this.updateConnectionStatus(true);
                    
                    this.addLog('âœ… è®¾å¤‡è¿æ¥æˆåŠŸï¼', 'success');
                    
                    // æ›´æ–°è®¾å¤‡ä¿¡æ¯
                    setTimeout(() => {
                        document.getElementById('deviceName').textContent = this.device.productName || 'Androidè®¾å¤‡';
                        document.getElementById('deviceStatus').textContent = 'å·²è¿æ¥';
                        document.getElementById('deviceInfo').style.display = 'block';
                    }, 500);
                    
                    // éšè—è¿›åº¦æ¡
                    setTimeout(() => {
                        document.getElementById('progressContainer').style.display = 'none';
                    }, 1000);
                    
                    return true;
                } catch (error) {
                    this.addLog(`æ‰“å¼€è®¾å¤‡å¤±è´¥ï¼š${error.message}`, 'error');
                    return false;
                }
            }
            
            // æ›´æ–°è¿æ¥çŠ¶æ€
            updateConnectionStatus(connected) {
                const statusIcon = document.getElementById('statusIcon');
                const statusText = document.getElementById('statusText');
                const connectBtn = document.getElementById('connectBtn');
                const disconnectBtn = document.getElementById('disconnectBtn');
                const flashBtn = document.getElementById('flashBtn');
                const runCmdBtn = document.getElementById('runCmdBtn');
                const commandBtns = document.querySelectorAll('.command-btn');
                const toolCards = document.querySelectorAll('.tool-card');
                
                if (connected) {
                    statusIcon.className = 'status-icon connected';
                    statusIcon.innerHTML = '<i class="fas fa-link"></i>';
                    statusText.textContent = 'è®¾å¤‡å·²è¿æ¥';
                    connectBtn.style.display = 'none';
                    disconnectBtn.style.display = 'block';
                    flashBtn.disabled = false;
                    runCmdBtn.disabled = false;
                    
                    // å¯ç”¨æ‰€æœ‰æŒ‰é’®
                    commandBtns.forEach(btn => {
                        btn.style.opacity = '1';
                        btn.style.pointerEvents = 'auto';
                    });
                    
                    toolCards.forEach(card => {
                        card.style.opacity = '1';
                        card.style.pointerEvents = 'auto';
                    });
                    
                } else {
                    statusIcon.className = 'status-icon disconnected';
                    statusIcon.innerHTML = '<i class="fas fa-plug"></i>';
                    statusText.textContent = 'ç­‰å¾…è¿æ¥è®¾å¤‡';
                    connectBtn.style.display = 'block';
                    disconnectBtn.style.display = 'none';
                    flashBtn.disabled = true;
                    runCmdBtn.disabled = true;
                    
                    // ç¦ç”¨æ‰€æœ‰æŒ‰é’®
                    commandBtns.forEach(btn => {
                        btn.style.opacity = '0.5';
                        btn.style.pointerEvents = 'none';
                    });
                    
                    toolCards.forEach(card => {
                        card.style.opacity = '0.5';
                        card.style.pointerEvents = 'none';
                    });
                    
                    document.getElementById('deviceInfo').style.display = 'none';
                }
            }
            
            // åˆ·å†™åˆ†åŒºï¼ˆæ¨¡æ‹ŸçœŸå®åˆ·å†™è¿‡ç¨‹ï¼‰
            async flashPartition(partition, file) {
                if (!this.connected) {
                    this.addLog('è¯·å…ˆè¿æ¥è®¾å¤‡ï¼', 'error');
                    return;
                }
                
                if (!partition) {
                    this.addLog('è¯·è¾“å…¥åˆ†åŒºåç§°ï¼', 'error');
                    return;
                }
                
                if (!file) {
                    this.addLog('è¯·é€‰æ‹©é•œåƒæ–‡ä»¶ï¼', 'error');
                    return;
                }
                
                this.addLog(`å¼€å§‹åˆ·å†™ ${partition} åˆ†åŒº...`);
                this.addLog(`æ–‡ä»¶ï¼š${file.name}`);
                
                // æ˜¾ç¤ºè¿›åº¦æ¡
                this.showProgress('progressContainer');
                
                try {
                    // æ¨¡æ‹Ÿåˆ·å†™è¿‡ç¨‹
                    this.updateProgress(0, 'æ­£åœ¨å‡†å¤‡åˆ·å†™...', 'progressContainer');
                    
                    await new Promise(resolve => setTimeout(resolve, 500));
                    this.updateProgress(10, 'æ­£åœ¨éªŒè¯æ–‡ä»¶...', 'progressContainer');
                    
                    await new Promise(resolve => setTimeout(resolve, 500));
                    this.updateProgress(30, 'æ­£åœ¨å‘é€æ•°æ®...', 'progressContainer');
                    
                    await new Promise(resolve => setTimeout(resolve, 1000));
                    this.updateProgress(60, 'æ­£åœ¨å†™å…¥åˆ†åŒº...', 'progressContainer');
                    
                    await new Promise(resolve => setTimeout(resolve, 1000));
                    this.updateProgress(90, 'æ­£åœ¨éªŒè¯åˆ·å†™...', 'progressContainer');
                    
                    await new Promise(resolve => setTimeout(resolve, 500));
                    this.updateProgress(100, 'åˆ·å†™å®Œæˆï¼', 'progressContainer');
                    
                    this.addLog(`âœ… ${partition} åˆ†åŒºåˆ·å†™æˆåŠŸï¼`, 'success');
                    
                    // éšè—è¿›åº¦æ¡
                    setTimeout(() => {
                        document.getElementById('progressContainer').style.display = 'none';
                    }, 2000);
                    
                } catch (error) {
                    this.addLog(`åˆ·å†™å¤±è´¥ï¼š${error.message}`, 'error');
                    document.getElementById('progressContainer').style.display = 'none';
                }
            }
            
            // æ˜¾ç¤ºè¿›åº¦æ¡
            showProgress(containerId) {
                const container = document.getElementById(containerId);
                const fill = document.getElementById('progressFill');
                const text = document.getElementById('progressText');
                const percent = document.getElementById('progressPercent');
                
                container.style.display = 'block';
                fill.style.width = '0%';
                text.textContent = 'å‡†å¤‡å¼€å§‹...';
                percent.textContent = '0%';
            }
            
            // æ›´æ–°è¿›åº¦
            updateProgress(value, message, containerId) {
                const fill = document.getElementById('progressFill');
                const text = document.getElementById('progressText');
                const percent = document.getElementById('progressPercent');
                
                fill.style.width = `${value}%`;
                text.textContent = message;
                percent.textContent = `${value}%`;
            }
            
            // æ‰§è¡Œå‘½ä»¤
            async executeCommand(command) {
                if (!this.connected) {
                    this.addLog('è¯·å…ˆè¿æ¥è®¾å¤‡ï¼', 'error');
                    return;
                }
                
                if (!command) {
                    this.addLog('è¯·è¾“å…¥å‘½ä»¤ï¼', 'error');
                    return;
                }
                
                this.addLog(`æ‰§è¡Œå‘½ä»¤ï¼š${command}`);
                
                try {
                    // æ¨¡æ‹Ÿå‘½ä»¤æ‰§è¡Œ
                    await new Promise(resolve => setTimeout(resolve, 1000));
                    
                    const responses = {
                        'reboot': 'è®¾å¤‡æ­£åœ¨é‡å¯...',
                        'reboot bootloader': 'æ­£åœ¨é‡å¯åˆ°Fastbootæ¨¡å¼...',
                        'reboot recovery': 'æ­£åœ¨é‡å¯åˆ°Recoveryæ¨¡å¼...',
                        'fastboot continue': 'æ­£åœ¨ç»§ç»­å¯åŠ¨ç³»ç»Ÿ...',
                        'fastboot devices': 'å·²è¿æ¥ 1 ä¸ªè®¾å¤‡',
                        'getvar all': 'è·å–è®¾å¤‡ä¿¡æ¯æˆåŠŸ',
                        'flash boot': 'åˆ·å†™bootåˆ†åŒºæˆåŠŸ',
                        'erase system': 'æ“¦é™¤systemåˆ†åŒºæˆåŠŸ',
                        'format:ext4 userdata': 'æ ¼å¼åŒ–dataåˆ†åŒºæˆåŠŸ'
                    };
                    
                    const response = responses[command] || `å‘½ä»¤æ‰§è¡Œå®Œæˆï¼š${command}`;
                    this.addLog(`âœ… ${response}`, 'success');
                    
                } catch (error) {
                    this.addLog(`å‘½ä»¤æ‰§è¡Œå¤±è´¥ï¼š${error.message}`, 'error');
                }
            }
            
            // æ‰§è¡Œå·¥å…·ç®±åŠŸèƒ½
            async executeTool(toolId) {
                if (!this.connected) {
                    this.addLog('è¯·å…ˆè¿æ¥è®¾å¤‡ï¼', 'error');
                    return;
                }
                
                switch(toolId) {
                    case 'unlock':
                        await this.unlockBootloader();
                        break;
                    case 'recovery':
                        await this.flashRecovery();
                        break;
                    case 'root':
                        await this.rootDevice();
                        break;
                    case 'backup':
                        await this.backupPartition();
                        break;
                    case 'format':
                        await this.formatData();
                        break;
                    case 'gsi':
                        await this.flashGSI();
                        break;
                }
            }
            
            // è§£é”Bootloader
            async unlockBootloader() {
                this.addLog('ğŸ”“ å¼€å§‹è§£é”Bootloader...', 'warning');
                this.addLog('âš ï¸ æ³¨æ„ï¼šè§£é”ä¼šæ¸…é™¤æ‰€æœ‰ç”¨æˆ·æ•°æ®ï¼', 'warning');
                
                if (!confirm('è§£é”Bootloaderä¼šæ¸…é™¤æ‰€æœ‰ç”¨æˆ·æ•°æ®ï¼\nè¯·ç¡®ä¿å·²å¤‡ä»½é‡è¦æ•°æ®ï¼\nç¡®å®šè¦ç»§ç»­å—ï¼Ÿ')) {
                    this.addLog('å–æ¶ˆäº†è§£é”æ“ä½œ');
                    return;
                }
                
                this.showProgress('progressContainer');
                this.updateProgress(0, 'æ­£åœ¨æ£€æŸ¥è®¾å¤‡...', 'progressContainer');
                
                for (let i = 10; i <= 100; i += 10) {
                    await new Promise(resolve => setTimeout(resolve, 300));
                    this.updateProgress(i, `æ­£åœ¨è§£é”... ${i}%`, 'progressContainer');
                }
                
                this.addLog('âœ… Bootloaderè§£é”æˆåŠŸï¼', 'success');
                this.addLog('è®¾å¤‡å°†è‡ªåŠ¨é‡å¯å¹¶æ¸…é™¤æ•°æ®', 'info');
                
                setTimeout(() => {
                    document.getElementById('progressContainer').style.display = 'none';
                }, 2000);
            }
            
            // åˆ·å…¥Recovery
            async flashRecovery() {
                this.addLog('ğŸ“¥ å¼€å§‹åˆ·å…¥TWRP Recovery...');
                
                // æ¨¡æ‹Ÿåˆ·å†™è¿‡ç¨‹
                this.showProgress('progressContainer');
                
                for (let i = 0; i <= 100; i += 10) {
                    await new Promise(resolve => setTimeout(resolve, 200));
                    this.updateProgress(i, `æ­£åœ¨åˆ·å…¥Recovery... ${i}%`, 'progressContainer');
                }
                
                this.addLog('âœ… TWRP Recoveryåˆ·å…¥æˆåŠŸï¼', 'success');
                
                setTimeout(() => {
                    document.getElementById('progressContainer').style.display = 'none';
                }, 2000);
            }
            
            // è·å–Rootæƒé™
            async rootDevice() {
                this.addLog('ğŸ‘‘ å¼€å§‹è·å–Rootæƒé™...');
                
                this.showProgress('progressContainer');
                
                for (let i = 0; i <= 100; i += 10) {
                    await new Promise(resolve => setTimeout(resolve, 200));
                    this.updateProgress(i, `æ­£åœ¨è·å–Rootæƒé™... ${i}%`, 'progressContainer');
                }
                
                this.addLog('âœ… Rootæƒé™è·å–æˆåŠŸï¼', 'success');
                
                setTimeout(() => {
                    document.getElementById('progressContainer').style.display = 'none';
                }, 2000);
            }
            
            // å¤‡ä»½åˆ†åŒº
            async backupPartition() {
                this.addLog('ğŸ’¾ å¼€å§‹å¤‡ä»½åˆ†åŒº...');
                
                this.showProgress('progressContainer');
                
                for (let i = 0; i <= 100; i += 10) {
                    await new Promise(resolve => setTimeout(resolve, 200));
                    this.updateProgress(i, `æ­£åœ¨å¤‡ä»½åˆ†åŒº... ${i}%`, 'progressContainer');
                }
                
                this.addLog('âœ… åˆ†åŒºå¤‡ä»½æˆåŠŸï¼', 'success');
                this.addLog('å¤‡ä»½æ–‡ä»¶å·²ä¿å­˜åˆ°ç”µè„‘', 'info');
                
                setTimeout(() => {
                    document.getElementById('progressContainer').style.display = 'none';
                }, 2000);
            }
            
            // æ ¼å¼åŒ–Dataåˆ†åŒº
            async formatData() {
                this.addLog('ğŸ§¹ å¼€å§‹æ ¼å¼åŒ–Dataåˆ†åŒº...', 'warning');
                this.addLog('âš ï¸ æ³¨æ„ï¼šæ ¼å¼åŒ–ä¼šæ¸…é™¤æ‰€æœ‰ç”¨æˆ·æ•°æ®ï¼', 'warning');
                
                if (!confirm('æ ¼å¼åŒ–Dataåˆ†åŒºä¼šæ¸…é™¤æ‰€æœ‰ç”¨æˆ·æ•°æ®ï¼\nè¯·ç¡®ä¿å·²å¤‡ä»½é‡è¦æ•°æ®ï¼\nç¡®å®šè¦ç»§ç»­å—ï¼Ÿ')) {
                    this.addLog('å–æ¶ˆäº†æ ¼å¼åŒ–æ“ä½œ');
                    return;
                }
                
                this.showProgress('progressContainer');
                this.updateProgress(0, 'æ­£åœ¨æ£€æŸ¥è®¾å¤‡...', 'progressContainer');
                
                for (let i = 10; i <= 100; i += 10) {
                    await new Promise(resolve => setTimeout(resolve, 300));
                    this.updateProgress(i, `æ­£åœ¨æ ¼å¼åŒ–... ${i}%`, 'progressContainer');
                }
                
                this.addLog('âœ… Dataåˆ†åŒºæ ¼å¼åŒ–æˆåŠŸï¼', 'success');
                
                setTimeout(() => {
                    document.getElementById('progressContainer').style.display = 'none';
                }, 2000);
            }
            
            // åˆ·å…¥GSIç³»ç»Ÿ
            async flashGSI() {
                this.addLog('ğŸŒ å¼€å§‹åˆ·å…¥GSIç³»ç»Ÿ...');
                
                this.showProgress('progressContainer');
                
                for (let i = 0; i <= 100; i += 10) {
                    await new Promise(resolve => setTimeout(resolve, 200));
                    this.updateProgress(i, `æ­£åœ¨åˆ·å…¥GSIç³»ç»Ÿ... ${i}%`, 'progressContainer');
                }
                
                this.addLog('âœ… GSIç³»ç»Ÿåˆ·å…¥æˆåŠŸï¼', 'success');
                
                setTimeout(() => {
                    document.getElementById('progressContainer').style.display = 'none';
                }, 2000);
            }
            
            // æ–­å¼€è¿æ¥
            async disconnect() {
                if (this.device && this.device.opened) {
                    try {
                        await this.device.close();
                    } catch (error) {
                        // å¿½ç•¥é”™è¯¯
                    }
                }
                
                this.device = null;
                this.connected = false;
                this.updateConnectionStatus(false);
                
                this.addLog('è®¾å¤‡å·²æ–­å¼€è¿æ¥');
            }
            
            // æ ¼å¼åŒ–æ–‡ä»¶å¤§å°
            formatFileSize(bytes) {
                if (bytes === 0) return '0 B';
                const sizes = ['B', 'KB', 'MB', 'GB'];
                const i = Math.floor(Math.log(bytes) / Math.log(1024));
                return parseFloat((bytes / Math.pow(1024, i)).toFixed(2)) + ' ' + sizes[i];
            }
            
            // æ˜¾ç¤ºæ¶ˆæ¯
            showMessage(title, message) {
                alert(`${title}\n\n${message}`);
            }
        }
        
        // åˆ›å»ºå·¥å…·å®ä¾‹
        const tool = new YuanyuanFlashTool();
        
        // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', () => {
            // æ£€æŸ¥WebUSBæ”¯æŒ
            if (!navigator.usb) {
                document.getElementById('connectBtn').disabled = true;
                document.getElementById('connectBtn').innerHTML = '<i class="fas fa-exclamation-triangle"></i> æµè§ˆå™¨ä¸æ”¯æŒ';
                tool.addLog('ğŸ˜¢ æµè§ˆå™¨ä¸æ”¯æŒWebUSB', 'error');
            }
            
            // å·¥å…·ç®±æŒ‰é’®
            document.getElementById('toolboxBtn').addEventListener('click', () => {
                document.getElementById('toolboxModal').style.display = 'flex';
            });
            
            // å…³é—­å·¥å…·ç®±æŒ‰é’®
            document.getElementById('closeToolbox').addEventListener('click', () => {
                document.getElementById('toolboxModal').style.display = 'none';
            });
            
            // ç‚¹å‡»å·¥å…·ç®±å¤–éƒ¨å…³é—­
            document.getElementById('toolboxModal').addEventListener('click', (e) => {
                if (e.target === document.getElementById('toolboxModal')) {
                    document.getElementById('toolboxModal').style.display = 'none';
                }
            });
            
            // è¿æ¥è®¾å¤‡æŒ‰é’®
            document.getElementById('connectBtn').addEventListener('click', async () => {
                await tool.connectDevice();
            });
            
            // æ–­å¼€è¿æ¥æŒ‰é’®
            document.getElementById('disconnectBtn').addEventListener('click', async () => {
                await tool.disconnect();
            });
            
            // æ–‡ä»¶é€‰æ‹©
            const fileInput = document.getElementById('fileInput');
            const fileDropArea = document.getElementById('fileDropArea');
            const selectedFileContainer = document.getElementById('selectedFileContainer');
            const fileName = document.getElementById('fileName');
            const fileSize = document.getElementById('fileSize');
            
            fileDropArea.addEventListener('click', () => {
                fileInput.click();
            });
            
            fileInput.addEventListener('change', (e) => {
                const file = e.target.files[0];
                if (file) {
                    tool.selectedFile = file;
                    fileName.textContent = file.name;
                    fileSize.textContent = tool.formatFileSize(file.size);
                    selectedFileContainer.style.display = 'block';
                    tool.addLog(`é€‰æ‹©äº†æ–‡ä»¶ï¼š${file.name}`);
                }
            });
            
            // ç§»é™¤æ–‡ä»¶æŒ‰é’®
            document.getElementById('removeFileBtn').addEventListener('click', () => {
                tool.selectedFile = null;
                fileInput.value = '';
                selectedFileContainer.style.display = 'none';
                tool.addLog('å·²ç§»é™¤é€‰æ‹©çš„æ–‡ä»¶');
            });
            
            // åˆ†åŒºæŒ‰é’®
            document.querySelectorAll('.partition-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    document.getElementById('partitionInput').value = btn.dataset.partition;
                });
            });
            
            // åˆ·å†™æŒ‰é’®
            document.getElementById('flashBtn').addEventListener('click', async () => {
                const partition = document.getElementById('partitionInput').value.trim();
                await tool.flashPartition(partition, tool.selectedFile);
            });
            
            // æ‰§è¡Œå‘½ä»¤æŒ‰é’®
            document.getElementById('runCmdBtn').addEventListener('click', async () => {
                const command = document.getElementById('commandInput').value.trim();
                await tool.executeCommand(command);
                document.getElementById('commandInput').value = '';
            });
            
            // å‘½ä»¤è¾“å…¥æ¡†å›è½¦æ‰§è¡Œ
            document.getElementById('commandInput').addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    document.getElementById('runCmdBtn').click();
                }
            });
            
            // å·¥å…·ç®±ä¸­çš„å·¥å…·å¡ç‰‡
            document.querySelectorAll('.tool-card').forEach(card => {
                card.addEventListener('click', () => {
                    const toolId = card.dataset.tool;
                    tool.executeTool(toolId);
                    document.getElementById('toolboxModal').style.display = 'none';
                });
            });
            
            // å·¥å…·ç®±ä¸­çš„å¿«é€Ÿå‘½ä»¤
            document.querySelectorAll('.command-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    const command = btn.dataset.command;
                    document.getElementById('commandInput').value = command;
                    document.getElementById('runCmdBtn').click();
                    document.getElementById('toolboxModal').style.display = 'none';
                });
            });
            
            // æ¸…ç©ºæ—¥å¿—æŒ‰é’®
            document.getElementById('clearLogBtn').addEventListener('click', () => {
                tool.logs = [];
                tool.updateLogDisplay();
                tool.addLog('æ—¥å¿—å·²æ¸…ç©º');
            });
            
            // æµ‹è¯•æŒ‰é’®
            document.getElementById('testBtn').addEventListener('click', () => {
                if (!tool.connected) {
                    tool.addLog('è¯·å…ˆè¿æ¥è®¾å¤‡ï¼', 'error');
                    return;
                }
                
                tool.addLog('æ­£åœ¨æµ‹è¯•è®¾å¤‡è¿æ¥...');
                tool.addLog('âœ… è®¾å¤‡è¿æ¥æ­£å¸¸ï¼', 'success');
            });
            
            // æ–‡ä»¶æ‹–æ”¾åŠŸèƒ½
            fileDropArea.addEventListener('dragover', (e) => {
                e.preventDefault();
                fileDropArea.style.borderColor = '#8bd3ff';
                fileDropArea.style.backgroundColor = '#f8faff';
            });
            
            fileDropArea.addEventListener('dragleave', () => {
                fileDropArea.style.borderColor = '#b5e6ff';
                fileDropArea.style.backgroundColor = '';
            });
            
            fileDropArea.addEventListener('drop', (e) => {
                e.preventDefault();
                fileDropArea.style.borderColor = '#b5e6ff';
                fileDropArea.style.backgroundColor = '';
                
                const file = e.dataTransfer.files[0];
                if (file && file.name.endsWith('.img')) {
                    tool.selectedFile = file;
                    fileName.textContent = file.name;
                    fileSize.textContent = tool.formatFileSize(file.size);
                    selectedFileContainer.style.display = 'block';
                    tool.addLog(`æ‹–æ”¾äº†æ–‡ä»¶ï¼š${file.name}`);
                } else {
                    tool.addLog('è¯·é€‰æ‹© .img æ ¼å¼çš„æ–‡ä»¶ï¼', 'error');
                }
            });
            
            // å‰ç¥¥ç‰©ç‚¹å‡»æ•ˆæœ
            document.querySelector('.mascot').addEventListener('click', () => {
                tool.addLog('ğŸ˜Š ç‚¹å‡»äº†å¯çˆ±çš„æ˜Ÿæ˜Ÿï¼');
            });
            
            // æƒé™å¼¹çª—æŒ‰é’®
            document.getElementById('permissionAllow').addEventListener('click', () => {
                document.getElementById('permissionModal').style.display = 'none';
            });
            
            document.getElementById('permissionCancel').addEventListener('click', () => {
                document.getElementById('permissionModal').style.display = 'none';
            });
        });
    </script>
</body>
</html>

