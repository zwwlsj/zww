<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸŒ¸ æºæºåˆ·æœºå·¥å…·ç®± âœ¨</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', 'Microsoft YaHei', sans-serif;
            background: linear-gradient(135deg, #ffb8e6 0%, #d9b8ff 30%, #a3d9ff 100%);
            min-height: 100vh;
            padding: 20px;
            color: #333;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.92);
            backdrop-filter: blur(20px);
            border-radius: 24px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            overflow: hidden;
            border: 2px solid rgba(255, 184, 230, 0.3);
        }
        
        /* å¯çˆ±çš„å¤´éƒ¨ */
        .header {
            background: linear-gradient(135deg, #ff9ad5 0%, #b28cff 100%);
            padding: 30px 40px;
            text-align: center;
            border-bottom: 3px dashed rgba(255, 255, 255, 0.4);
            position: relative;
            overflow: hidden;
        }
        
        .header::before {
            content: "âœ¨";
            position: absolute;
            font-size: 60px;
            top: 20px;
            left: 20px;
            opacity: 0.3;
        }
        
        .header::after {
            content: "ğŸŒ¸";
            position: absolute;
            font-size: 60px;
            bottom: 20px;
            right: 20px;
            opacity: 0.3;
        }
        
        .title {
            font-size: 2.8rem;
            color: white;
            text-shadow: 3px 3px 0 rgba(255, 119, 184, 0.3);
            margin-bottom: 10px;
            position: relative;
            z-index: 1;
        }
        
        .subtitle {
            color: rgba(255, 255, 255, 0.9);
            font-size: 1.2rem;
            position: relative;
            z-index: 1;
        }
        
        .yuanmascot {
            position: absolute;
            right: 40px;
            top: 50%;
            transform: translateY(-50%);
            font-size: 3rem;
            animation: float 3s ease-in-out infinite;
        }
        
        @keyframes float {
            0%, 100% { transform: translateY(-50%) translateY(0px); }
            50% { transform: translateY(-50%) translateY(-10px); }
        }
        
        /* æ ‡ç­¾é¡µæ ·å¼ */
        .tabs {
            display: flex;
            gap: 5px;
            margin-bottom: 20px;
            border-bottom: 2px solid rgba(255, 154, 213, 0.3);
        }
        
        .tab {
            padding: 12px 20px;
            background: rgba(255, 255, 255, 0.1);
            border: none;
            border-radius: 10px 10px 0 0;
            cursor: pointer;
            transition: all 0.3s;
            color: #666;
            font-weight: 500;
        }
        
        .tab.active {
            background: white;
            color: #ff6bc1;
            box-shadow: 0 -3px 10px rgba(255, 154, 213, 0.2);
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        /* ä¸»è¦å†…å®¹åŒºåŸŸ */
        .main-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 25px;
            padding: 30px;
        }
        
        @media (max-width: 768px) {
            .main-content {
                grid-template-columns: 1fr;
            }
        }
        
        /* å¡ç‰‡æ ·å¼ */
        .panel {
            background: white;
            border-radius: 20px;
            padding: 25px;
            box-shadow: 0 8px 20px rgba(178, 140, 255, 0.1);
            border: 2px solid rgba(255, 154, 213, 0.2);
            position: relative;
            transition: transform 0.3s, box-shadow 0.3s;
        }
        
        .panel:hover {
            transform: translateY(-5px);
            box-shadow: 0 12px 25px rgba(178, 140, 255, 0.2);
        }
        
        .panel-title {
            font-size: 1.4rem;
            color: #ff6bc1;
            margin-bottom: 20px;
            padding-bottom: 12px;
            border-bottom: 2px dashed #ffb8e6;
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .panel-title i {
            font-size: 1.3rem;
        }
        
        /* æŒ‰é’® - å¯çˆ±çš„é£æ ¼ */
        .btn {
            padding: 14px 24px;
            border: none;
            border-radius: 12px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            position: relative;
            overflow: hidden;
        }
        
        .btn::after {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
            transition: 0.5s;
        }
        
        .btn:hover::after {
            left: 100%;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #ff9ad5, #b28cff);
            color: white;
            box-shadow: 0 5px 15px rgba(255, 154, 213, 0.4);
        }
        
        .btn-success {
            background: linear-gradient(135deg, #a3ffb8, #4CAF50);
            color: white;
            box-shadow: 0 5px 15px rgba(163, 255, 184, 0.4);
        }
        
        .btn-danger {
            background: linear-gradient(135deg, #ff6b6b, #ff9e9e);
            color: white;
            box-shadow: 0 5px 15px rgba(255, 107, 107, 0.4);
        }
        
        .btn-secondary {
            background: linear-gradient(135deg, #e0e0e0, #b0b0b0);
            color: white;
        }
        
        .btn:hover:not(:disabled) {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(255, 154, 213, 0.6);
        }
        
        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none !important;
        }
        
        /* è®¾å¤‡è¿æ¥çŠ¶æ€ */
        .connection-status {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 20px;
            padding: 15px;
            background: linear-gradient(135deg, rgba(255, 154, 213, 0.1), rgba(178, 140, 255, 0.1));
            border-radius: 15px;
        }
        
        .status-indicator {
            width: 16px;
            height: 16px;
            border-radius: 50%;
            background: #ff6b6b;
            position: relative;
        }
        
        .status-indicator.connected {
            background: #4CAF50;
            box-shadow: 0 0 10px #4CAF50;
        }
        
        .status-indicator.connected::after {
            content: '';
            position: absolute;
            top: -4px;
            left: -4px;
            right: -4px;
            bottom: -4px;
            border-radius: 50%;
            border: 2px solid #4CAF50;
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0% { transform: scale(1); opacity: 1; }
            100% { transform: scale(1.5); opacity: 0; }
        }
        
        /* æ–‡ä»¶ä¸Šä¼ åŒºåŸŸ */
        .file-upload {
            border: 3px dashed #b28cff;
            border-radius: 15px;
            padding: 40px 20px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            margin: 20px 0;
            background: rgba(178, 140, 255, 0.05);
        }
        
        .file-upload:hover {
            border-color: #ff9ad5;
            background: rgba(255, 154, 213, 0.1);
            transform: scale(1.01);
        }
        
        .file-upload i {
            font-size: 3rem;
            color: #b28cff;
            margin-bottom: 15px;
        }
        
        /* é€‰ä¸­æ–‡ä»¶æ˜¾ç¤º */
        .file-info {
            background: linear-gradient(135deg, rgba(255, 154, 213, 0.1), rgba(178, 140, 255, 0.1));
            border-radius: 12px;
            padding: 15px;
            margin: 15px 0;
            border-left: 4px solid #ff9ad5;
        }
        
        /* è¿›åº¦æ¡ */
        .progress-container {
            background: rgba(178, 140, 255, 0.1);
            border-radius: 10px;
            padding: 15px;
            margin: 20px 0;
        }
        
        .progress-bar {
            height: 10px;
            background: linear-gradient(90deg, #ff9ad5, #b28cff);
            border-radius: 5px;
            width: 0%;
            transition: width 0.5s ease;
            position: relative;
            overflow: hidden;
        }
        
        .progress-bar::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            height: 100%;
            width: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.4), transparent);
            animation: shimmer 2s infinite;
        }
        
        @keyframes shimmer {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }
        
        /* å…¨é‡åŒ…ä¿¡æ¯ */
        .full-package-info {
            background: linear-gradient(135deg, rgba(163, 255, 184, 0.1), rgba(76, 175, 80, 0.1));
            border-radius: 12px;
            padding: 20px;
            margin: 20px 0;
            border-left: 4px solid #4CAF50;
        }
        
        .package-details {
            margin-top: 15px;
        }
        
        .package-detail {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px solid rgba(0, 0, 0, 0.1);
        }
        
        /* å·¥å…·æŒ‰é’®ç½‘æ ¼ */
        .tools-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 12px;
            margin: 20px 0;
        }
        
        .tool-btn {
            background: white;
            border: 2px solid rgba(255, 154, 213, 0.3);
            border-radius: 12px;
            padding: 15px 10px;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 8px;
        }
        
        .tool-btn:hover:not(:disabled) {
            background: linear-gradient(135deg, rgba(255, 154, 213, 0.1), rgba(178, 140, 255, 0.1));
            border-color: #ff9ad5;
            transform: translateY(-3px);
        }
        
        .tool-btn i {
            font-size: 1.8rem;
        }
        
        /* æ—¥å¿—ç»ˆç«¯ */
        .terminal {
            background: #1a1a2e;
            border-radius: 12px;
            padding: 20px;
            font-family: 'Courier New', monospace;
            font-size: 0.9rem;
            height: 250px;
            overflow-y: auto;
            margin: 20px 0;
            color: #e0e0e0;
            border: 2px solid rgba(255, 154, 213, 0.3);
        }
        
        .log-entry {
            padding: 5px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            line-height: 1.4;
        }
        
        .log-info { color: #a3d9ff; }
        .log-success { color: #a3ffb8; }
        .log-error { color: #ff9e9e; }
        .log-warning { color: #fff8a3; }
        
        /* å¯çˆ±çš„æç¤ºæ¡† */
        .tip-box {
            background: linear-gradient(135deg, rgba(255, 248, 163, 0.2), rgba(163, 255, 184, 0.2));
            border-radius: 12px;
            padding: 15px;
            margin: 20px 0;
            border-left: 4px solid #fff8a3;
        }
        
        /* åº•éƒ¨ */
        .footer {
            text-align: center;
            padding: 25px;
            color: rgba(255, 255, 255, 0.8);
            background: linear-gradient(135deg, rgba(255, 154, 213, 0.8), rgba(178, 140, 255, 0.8));
            border-top: 2px solid rgba(255, 255, 255, 0.2);
        }
        
        /* å“åº”å¼è°ƒæ•´ */
        @media (max-width: 480px) {
            .title { font-size: 2rem; }
            .panel { padding: 20px; }
            .tools-grid { grid-template-columns: repeat(2, 1fr); }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="yuanmascot">ğŸŒ¸</div>
            <h1 class="title">ğŸŒ¸ æºæºåˆ·æœºå·¥å…·ç®± âœ¨</h1>
            <p class="subtitle">ä¸€ä¸ªç®€å•å¥½ç”¨çš„åœ¨çº¿åˆ·æœºå·¥å…·ï¼</p>
        </div>
        
        <div class="main-content">
            <!-- å·¦ä¾§ï¼šè®¾å¤‡è¿æ¥å’Œåˆ·å†™ -->
            <div class="panel">
                <div class="panel-title">
                    <i class="fas fa-mobile-alt"></i> è¿æ¥è®¾å¤‡
                </div>
                
                <div class="connection-status">
                    <div class="status-indicator" id="statusIndicator"></div>
                    <span id="statusText">ç­‰å¾…è¿æ¥è®¾å¤‡...</span>
                </div>
                
                <div style="display: flex; gap: 12px; margin-bottom: 20px;">
                    <button id="connectBtn" class="btn btn-primary">
                        <i class="fas fa-plug"></i> è¿æ¥è®¾å¤‡
                    </button>
                    <button id="disconnectBtn" class="btn btn-danger" style="display: none;">
                        <i class="fas fa-unlink"></i> æ–­å¼€è¿æ¥
                    </button>
                </div>
                
                <div class="tip-box">
                    <i class="fas fa-lightbulb" style="color: #ffb300; margin-right: 8px;"></i>
                    å°è´´å£«ï¼šå…ˆæŠŠæ‰‹æœºè¿›å…¥Fastbootæ¨¡å¼ï¼Œç„¶åç”¨æ•°æ®çº¿è¿æ¥åˆ°ç”µè„‘å“¦ï½
                </div>
                
                <div id="deviceInfo" style="display: none;">
                    <div style="background: linear-gradient(135deg, rgba(255, 154, 213, 0.1), rgba(178, 140, 255, 0.1)); border-radius: 12px; padding: 20px;">
                        <h4 style="color: #ff6bc1; margin-bottom: 15px; display: flex; align-items: center; gap: 8px;">
                            <i class="fas fa-info-circle"></i> è®¾å¤‡ä¿¡æ¯
                        </h4>
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 12px;">
                            <div>
                                <div style="color: #888; font-size: 0.9rem;">è®¾å¤‡åç§°</div>
                                <div id="productName" style="font-weight: bold; color: #666;">-</div>
                            </div>
                            <div>
                                <div style="color: #888; font-size: 0.9rem;">åºåˆ—å·</div>
                                <div id="deviceSerial" style="font-weight: bold; color: #666;">-</div>
                            </div>
                            <div>
                                <div style="color: #888; font-size: 0.9rem;">è®¾å¤‡çŠ¶æ€</div>
                                <div id="deviceState" style="font-weight: bold; color: #666;">Fastbootæ¨¡å¼</div>
                            </div>
                            <div>
                                <div style="color: #888; font-size: 0.9rem;">å®‰å…¨çŠ¶æ€</div>
                                <div id="secureBoot" style="font-weight: bold; color: #666;">-</div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- åˆ·å†™æ ‡ç­¾é¡µ -->
                <div style="margin-top: 30px;">
                    <div class="tabs">
                        <button class="tab active" data-tab="single-flash">å•ä¸ªé•œåƒ</button>
                        <button class="tab" data-tab="full-flash">å…¨é‡åŒ…åˆ·å…¥</button>
                    </div>
                    
                    <!-- å•ä¸ªé•œåƒåˆ·å†™ -->
                    <div id="single-flash" class="tab-content active">
                        <div class="panel-title">
                            <i class="fas fa-file-upload"></i> åˆ·å†™å•ä¸ªé•œåƒ
                        </div>
                        
                        <div class="file-upload" id="singleFileUpload">
                            <i class="fas fa-cloud-upload-alt"></i>
                            <div style="font-size: 1.1rem; font-weight: 500; color: #666;">ç‚¹å‡»è¿™é‡Œé€‰æ‹©.imgé•œåƒæ–‡ä»¶</div>
                            <div style="font-size: 0.9rem; color: #888; margin-top: 8px;">
                                æ”¯æŒ .img æ ¼å¼æ–‡ä»¶ï¼Œæ‹–æ”¾æ–‡ä»¶åˆ°è¿™é‡Œä¹Ÿå¯ä»¥å“¦ï½
                            </div>
                            <input type="file" id="singleFileInput" accept=".img" style="display: none;">
                        </div>
                        
                        <div id="singleFileInfo" style="display: none;">
                            <div class="file-info">
                                <div style="display: flex; justify-content: space-between; align-items: center;">
                                    <div>
                                        <div id="singleFileName" style="font-weight: bold; color: #666;"></div>
                                        <div id="singleFileSize" style="font-size: 0.9rem; color: #888; margin-top: 4px;"></div>
                                    </div>
                                    <button id="removeSingleFile" class="btn btn-danger" style="padding: 8px 12px;">
                                        <i class="fas fa-times"></i> ç§»é™¤
                                    </button>
                                </div>
                            </div>
                        </div>
                        
                        <div style="margin-bottom: 20px;">
                            <label style="display: block; margin-bottom: 10px; color: #ff6bc1; font-weight: 500;">é€‰æ‹©è¦åˆ·å†™çš„åˆ†åŒº</label>
                            <select id="partitionSelect" style="width: 100%; padding: 12px; border: 2px solid rgba(255, 154, 213, 0.3); border-radius: 10px; font-size: 1rem; background: white; color: #666;">
                                <option value="boot">bootåˆ†åŒºï¼ˆç³»ç»Ÿå†…æ ¸ï¼‰</option>
                                <option value="system">systemåˆ†åŒºï¼ˆæ“ä½œç³»ç»Ÿï¼‰</option>
                                <option value="system_ext">system_extåˆ†åŒºï¼ˆç³»ç»Ÿæ‰©å±•ï¼‰</option>
                                <option value="vendor">vendoråˆ†åŒºï¼ˆé©±åŠ¨æ–‡ä»¶ï¼‰</option>
                                <option value="odm">odmåˆ†åŒºï¼ˆOEMå®šåˆ¶ï¼‰</option>
                                <option value="product">productåˆ†åŒºï¼ˆäº§å“å®šåˆ¶ï¼‰</option>
                                <option value="recovery">recoveryåˆ†åŒºï¼ˆæ¢å¤æ¨¡å¼ï¼‰</option>
                                <option value="userdata">userdataåˆ†åŒºï¼ˆç”¨æˆ·æ•°æ®ï¼‰</option>
                                <option value="cache">cacheåˆ†åŒºï¼ˆç¼“å­˜æ–‡ä»¶ï¼‰</option>
                                <option value="dtbo">dtboåˆ†åŒºï¼ˆè®¾å¤‡æ ‘ï¼‰</option>
                                <option value="vbmeta">vbmetaåˆ†åŒºï¼ˆéªŒè¯å¯åŠ¨ï¼‰</option>
                                <option value="vbmeta_system">vbmeta_systemåˆ†åŒº</option>
                            </select>
                        </div>
                        
                        <div id="singleProgressContainer" style="display: none;">
                            <div class="progress-container">
                                <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                                    <span id="singleProgressText" style="color: #666;">å‡†å¤‡å¼€å§‹...</span>
                                    <span id="singleProgressPercent" style="color: #ff6bc1; font-weight: bold;">0%</span>
                                </div>
                                <div class="progress-bar" id="singleProgressBar"></div>
                            </div>
                        </div>
                        
                        <button id="singleFlashBtn" class="btn btn-success" style="width: 100%; padding: 16px; font-size: 1.1rem;" disabled>
                            <i class="fas fa-bolt"></i> å¼€å§‹åˆ·å†™å•ä¸ªé•œåƒ
                        </button>
                    </div>
                    
                    <!-- å…¨é‡åŒ…åˆ·å…¥ -->
                    <div id="full-flash" class="tab-content">
                        <div class="panel-title">
                            <i class="fas fa-layer-group"></i> åˆ·å…¥å…¨é‡åŒ…
                        </div>
                        
                        <div class="tip-box">
                            <i class="fas fa-info-circle" style="color: #4CAF50; margin-right: 8px;"></i>
                            å…¨é‡åŒ…æ˜¯ä¸€ä¸ªå®Œæ•´çš„ç³»ç»ŸåŒ…ï¼ŒåŒ…å«æ‰€æœ‰åˆ†åŒºé•œåƒã€‚åˆ·å…¥åä¼šæ›¿æ¢æ•´ä¸ªç³»ç»Ÿå“¦ï¼
                        </div>
                        
                        <div class="file-upload" id="fullPackageUpload">
                            <i class="fas fa-file-archive"></i>
                            <div style="font-size: 1.1rem; font-weight: 500; color: #666;">ç‚¹å‡»è¿™é‡Œé€‰æ‹©å…¨é‡åŒ….zipæ–‡ä»¶</div>
                            <div style="font-size: 0.9rem; color: #888; margin-top: 8px;">
                                æ”¯æŒ .zip æ ¼å¼çš„å…¨é‡åŒ…æ–‡ä»¶
                            </div>
                            <input type="file" id="fullPackageInput" accept=".zip" style="display: none;">
                        </div>
                        
                        <div id="fullPackageInfo" style="display: none;">
                            <div class="full-package-info">
                                <div style="display: flex; justify-content: space-between; align-items: center;">
                                    <div>
                                        <div id="fullPackageName" style="font-weight: bold; color: #666; font-size: 1.1rem;"></div>
                                        <div id="fullPackageSize" style="font-size: 0.9rem; color: #888; margin-top: 4px;"></div>
                                    </div>
                                    <button id="removeFullPackage" class="btn btn-danger" style="padding: 8px 12px;">
                                        <i class="fas fa-times"></i> ç§»é™¤
                                    </button>
                                </div>
                                
                                <div class="package-details">
                                    <div class="package-detail">
                                        <span style="color: #666;">åŒ…ç±»å‹:</span>
                                        <span id="packageType" style="font-weight: bold; color: #4CAF50;">å…¨é‡åŒ…</span>
                                    </div>
                                    <div class="package-detail">
                                        <span style="color: #666;">åŒ…å«åˆ†åŒº:</span>
                                        <span id="partitionCount" style="font-weight: bold; color: #4CAF50;">è®¡ç®—ä¸­...</span>
                                    </div>
                                    <div class="package-detail">
                                        <span style="color: #666;">åˆ·å…¥æ—¶é—´:</span>
                                        <span id="estimatedTime" style="font-weight: bold; color: #4CAF50;">çº¦3-5åˆ†é’Ÿ</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div id="flashOptions" style="margin: 20px 0; display: none;">
                            <div style="margin-bottom: 15px;">
                                <label style="display: block; margin-bottom: 10px; color: #ff6bc1; font-weight: 500;">åˆ·å…¥é€‰é¡¹</label>
                                <div style="background: rgba(255, 154, 213, 0.1); border-radius: 10px; padding: 15px;">
                                    <div style="margin-bottom: 10px;">
                                        <input type="checkbox" id="wipeData" style="margin-right: 8px;">
                                        <label for="wipeData" style="color: #666;">åˆ·æœºå‰æ¸…é™¤ç”¨æˆ·æ•°æ®ï¼ˆæ¨èï¼‰</label>
                                    </div>
                                    <div style="margin-bottom: 10px;">
                                        <input type="checkbox" id="wipeCache" checked style="margin-right: 8px;">
                                        <label for="wipeCache" style="color: #666;">åˆ·æœºåæ¸…é™¤ç¼“å­˜åˆ†åŒº</label>
                                    </div>
                                    <div>
                                        <input type="checkbox" id="autoReboot" checked style="margin-right: 8px;">
                                        <label for="autoReboot" style="color: #666;">åˆ·æœºå®Œæˆåè‡ªåŠ¨é‡å¯</label>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div id="fullProgressContainer" style="display: none;">
                            <div class="progress-container">
                                <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                                    <span id="fullProgressText" style="color: #666;">å‡†å¤‡å¼€å§‹åˆ·å…¥å…¨é‡åŒ…...</span>
                                    <span id="fullProgressPercent" style="color: #4CAF50; font-weight: bold;">0%</span>
                                </div>
                                <div class="progress-bar" id="fullProgressBar"></div>
                            </div>
                        </div>
                        
                        <button id="fullFlashBtn" class="btn btn-success" style="width: 100%; padding: 16px; font-size: 1.1rem; display: none;">
                            <i class="fas fa-rocket"></i> å¼€å§‹åˆ·å…¥å…¨é‡åŒ…
                        </button>
                    </div>
                </div>
            </div>
            
            <!-- å³ä¾§ï¼šå·¥å…·å’Œæ—¥å¿— -->
            <div class="panel">
                <div class="panel-title">
                    <i class="fas fa-toolbox"></i> åˆ·æœºå·¥å…·ç®±
                </div>
                
                <div class="tools-grid">
                    <button class="tool-btn" data-command="reboot-bootloader">
                        <i class="fas fa-redo" style="color: #a3d9ff;"></i>
                        <span>é‡å¯åˆ°Fastboot</span>
                    </button>
                    
                    <button class="tool-btn" data-command="reboot-recovery">
                        <i class="fas fa-first-aid" style="color: #a3ffb8;"></i>
                        <span>é‡å¯åˆ°Recovery</span>
                    </button>
                    
                    <button class="tool-btn" data-command="reboot-system">
                        <i class="fas fa-power-off" style="color: #fff8a3;"></i>
                        <span>é‡å¯ç³»ç»Ÿ</span>
                    </button>
                    
                    <button class="tool-btn" data-command="unlock-bootloader">
                        <i class="fas fa-unlock" style="color: #b28cff;"></i>
                        <span>è§£é”Bootloader</span>
                    </button>
                    
                    <button class="tool-btn" data-command="lock-bootloader">
                        <i class="fas fa-lock" style="color: #ff6b6b;"></i>
                        <span>é”å®šBootloader</span>
                    </button>
                    
                    <button class="tool-btn" data-command="backup-partition">
                        <i class="fas fa-save" style="color: #a3ffb8;"></i>
                        <span>å¤‡ä»½åˆ†åŒº</span>
                    </button>
                    
                    <button class="tool-btn" data-command="erase-partition">
                        <i class="fas fa-eraser" style="color: #ff6b6b;"></i>
                        <span>æ“¦é™¤åˆ†åŒº</span>
                    </button>
                    
                    <button class="tool-btn" data-command="fastboot-continue">
                        <i class="fas fa-play" style="color: #ff9ad5;"></i>
                        <span>ç»§ç»­å¯åŠ¨</span>
                    </button>
                </div>
                
                <div class="panel-title" style="margin-top: 30px;">
                    <i class="fas fa-terminal"></i> Fastbootå‘½ä»¤
                </div>
                
                <div style="display: flex; gap: 12px; margin-bottom: 20px;">
                    <input type="text" id="commandInput" placeholder="è¾“å…¥fastbootå‘½ä»¤..." 
                           style="flex: 1; padding: 12px; border-radius: 10px; border: 2px solid rgba(255, 154, 213, 0.3); background: rgba(255, 255, 255, 0.9); color: #333; font-size: 1rem;">
                    <button id="sendCommand" class="btn btn-primary">
                        <i class="fas fa-play"></i> æ‰§è¡Œ
                    </button>
                </div>
                
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 10px; margin-bottom: 20px;">
                    <button class="btn btn-secondary" data-command="fastboot devices">
                        <i class="fas fa-list"></i> æŸ¥çœ‹è®¾å¤‡
                    </button>
                    <button class="btn btn-secondary" data-command="fastboot getvar all">
                        <i class="fas fa-info-circle"></i> è®¾å¤‡ä¿¡æ¯
                    </button>
                    <button class="btn btn-secondary" data-command="fastboot oem device-info">
                        <i class="fas fa-microchip"></i> OEMä¿¡æ¯
                    </button>
                </div>
                
                <div class="panel-title">
                    <i class="fas fa-scroll"></i> æ“ä½œæ—¥å¿—
                </div>
                
                <div class="terminal" id="logContainer">
                    <div class="log-entry log-info">ğŸŒ¸ æ¬¢è¿ä½¿ç”¨æºæºåˆ·æœºå·¥å…·ç®±ï½</div>
                    <div class="log-entry log-info">ğŸ”Œ è¯·å…ˆè¿æ¥è®¾å¤‡ï¼Œç„¶åå¼€å§‹æ„‰å¿«çš„åˆ·æœºä¹‹æ—…å§ï¼</div>
                    <div class="log-entry log-info">ğŸ’¡ æ–°å¢å…¨é‡åŒ…åˆ·å…¥åŠŸèƒ½ï¼Œå¯ä»¥åˆ·å…¥å®Œæ•´ç³»ç»Ÿï¼</div>
                </div>
                
                <div style="display: flex; gap: 12px; margin-top: 20px;">
                    <button id="clearLog" class="btn btn-secondary">
                        <i class="fas fa-trash-alt"></i> æ¸…ç©ºæ—¥å¿—
                    </button>
                    <button id="exportLog" class="btn btn-secondary">
                        <i class="fas fa-download"></i> å¯¼å‡ºæ—¥å¿—
                    </button>
                </div>
            </div>
        </div>
        
        <div class="footer">
            <p style="font-size: 1.1rem; margin-bottom: 8px;">ğŸŒ¸ æºæºåˆ·æœºå·¥å…·ç®± âœ¨</p>
            <p style="font-size: 0.9rem; opacity: 0.9;">ä¸€ä¸ªå¯çˆ±åˆå®ç”¨çš„åœ¨çº¿åˆ·æœºå·¥å…·</p>
            <p style="font-size: 0.8rem; margin-top: 15px; opacity: 0.7;">âš ï¸ åˆ·æœºæœ‰é£é™©ï¼Œè¯·åŠ¡å¿…å¤‡ä»½é‡è¦æ•°æ®å“¦ï¼å…¨é‡åŒ…åˆ·å…¥ä¼šè¦†ç›–æ•´ä¸ªç³»ç»Ÿï¼</p>
        </div>
    </div>

    <script>
        // æºæºåˆ·æœºå·¥å…·ç®±
        class YuanYuanFlashTool {
            constructor() {
                this.device = null;
                this.connected = false;
                this.singleFile = null;
                this.fullPackage = null;
                this.logs = [];
                this.flashInProgress = false;
                this.currentStep = 0;
                this.totalSteps = 0;
                
                this.init();
            }
            
            init() {
                this.addLog('ğŸŒ¸ æ¬¢è¿ä½¿ç”¨æºæºåˆ·æœºå·¥å…·ç®±ï½', 'info');
                this.addLog('ğŸ”Œ è¯·å…ˆè¿æ¥è®¾å¤‡ï¼Œç„¶åå¼€å§‹æ„‰å¿«çš„åˆ·æœºä¹‹æ—…å§ï¼', 'info');
                this.addLog('ğŸ’¡ æ–°å¢å…¨é‡åŒ…åˆ·å…¥åŠŸèƒ½ï¼Œå¯ä»¥åˆ·å…¥å®Œæ•´ç³»ç»Ÿï¼', 'info');
                
                this.initEventListeners();
                this.checkBrowserSupport();
            }
            
            // æ£€æŸ¥æµè§ˆå™¨æ”¯æŒ
            checkBrowserSupport() {
                if (!navigator.usb) {
                    this.addLog('âŒ å“å‘€ï¼Œä½ çš„æµè§ˆå™¨ä¸æ”¯æŒè¿æ¥è®¾å¤‡å‘¢...', 'error');
                    this.addLog('ğŸ’¡ è¯•è¯•ç”¨æœ€æ–°ç‰ˆçš„Chromeæˆ–Edgeæµè§ˆå™¨å§ï½', 'warning');
                    this.showMessage('æµè§ˆå™¨ä¸æ”¯æŒ', 'ç”¨æœ€æ–°ç‰ˆçš„Chromeæˆ–Edgeè¯•è¯•çœ‹å§ï½');
                    return false;
                }
                
                this.addLog('âœ… æµè§ˆå™¨æ”¯æŒè¿æ¥è®¾å¤‡åŠŸèƒ½ï¼å¥½æ£’ï½', 'success');
                return true;
            }
            
            // åˆå§‹åŒ–äº‹ä»¶ç›‘å¬
            initEventListeners() {
                // è¿æ¥è®¾å¤‡æŒ‰é’®
                document.getElementById('connectBtn').addEventListener('click', () => {
                    this.connectDevice();
                });
                
                // æ–­å¼€è¿æ¥æŒ‰é’®
                document.getElementById('disconnectBtn').addEventListener('click', () => {
                    this.disconnectDevice();
                });
                
                // æ ‡ç­¾é¡µåˆ‡æ¢
                document.querySelectorAll('.tab').forEach(tab => {
                    tab.addEventListener('click', () => {
                        const tabId = tab.getAttribute('data-tab');
                        this.switchTab(tabId);
                    });
                });
                
                // å•ä¸ªæ–‡ä»¶ä¸Šä¼ 
                const singleFileUpload = document.getElementById('singleFileUpload');
                const singleFileInput = document.getElementById('singleFileInput');
                
                singleFileUpload.addEventListener('click', () => {
                    singleFileInput.click();
                    this.addLog('ğŸ“ æ­£åœ¨é€‰æ‹©é•œåƒæ–‡ä»¶...', 'info');
                });
                
                singleFileInput.addEventListener('change', (e) => {
                    if (e.target.files.length > 0) {
                        this.handleSingleFileSelect(e.target.files[0]);
                    }
                });
                
                // å…¨é‡åŒ…ä¸Šä¼ 
                const fullPackageUpload = document.getElementById('fullPackageUpload');
                const fullPackageInput = document.getElementById('fullPackageInput');
                
                fullPackageUpload.addEventListener('click', () => {
                    fullPackageInput.click();
                    this.addLog('ğŸ“¦ æ­£åœ¨é€‰æ‹©å…¨é‡åŒ…æ–‡ä»¶...', 'info');
                });
                
                fullPackageInput.addEventListener('change', (e) => {
                    if (e.target.files.length > 0) {
                        this.handleFullPackageSelect(e.target.files[0]);
                    }
                });
                
                // æ‹–æ”¾æ–‡ä»¶
                [singleFileUpload, fullPackageUpload].forEach(area => {
                    area.addEventListener('dragover', (e) => {
                        e.preventDefault();
                        area.style.borderColor = '#ff9ad5';
                        area.style.background = 'rgba(255, 154, 213, 0.2)';
                    });
                    
                    area.addEventListener('dragleave', () => {
                        area.style.borderColor = '#b28cff';
                        area.style.background = 'rgba(178, 140, 255, 0.05)';
                    });
                    
                    area.addEventListener('drop', (e) => {
                        e.preventDefault();
                        area.style.borderColor = '#b28cff';
                        area.style.background = 'rgba(178, 140, 255, 0.05)';
                        if (e.dataTransfer.files.length > 0) {
                            const file = e.dataTransfer.files[0];
                            if (area.id === 'singleFileUpload' && file.name.endsWith('.img')) {
                                this.handleSingleFileSelect(file);
                            } else if (area.id === 'fullPackageUpload' && file.name.endsWith('.zip')) {
                                this.handleFullPackageSelect(file);
                            }
                        }
                    });
                });
                
                // ç§»é™¤å•ä¸ªæ–‡ä»¶
                document.getElementById('removeSingleFile').addEventListener('click', () => {
                    this.removeSingleFile();
                });
                
                // ç§»é™¤å…¨é‡åŒ…
                document.getElementById('removeFullPackage').addEventListener('click', () => {
                    this.removeFullPackage();
                });
                
                // åˆ·å†™å•ä¸ªé•œåƒæŒ‰é’®
                document.getElementById('singleFlashBtn').addEventListener('click', () => {
                    this.flashSingleImage();
                });
                
                // åˆ·å…¥å…¨é‡åŒ…æŒ‰é’®
                document.getElementById('fullFlashBtn').addEventListener('click', () => {
                    this.flashFullPackage();
                });
                
                // å·¥å…·æŒ‰é’®
                document.querySelectorAll('.tool-btn').forEach(btn => {
                    btn.addEventListener('click', () => {
                        const command = btn.getAttribute('data-command');
                        this.executeTool(command);
                    });
                });
                
                // å‘½ä»¤æŒ‰é’®
                document.querySelectorAll('[data-command]').forEach(btn => {
                    if (btn.classList.contains('btn')) {
                        btn.addEventListener('click', () => {
                            const command = btn.getAttribute('data-command');
                            document.getElementById('commandInput').value = command;
                        });
                    }
                });
                
                // å‘é€å‘½ä»¤
                document.getElementById('sendCommand').addEventListener('click', () => {
                    this.sendCustomCommand();
                });
                
                // å‘½ä»¤è¾“å…¥æ¡†å›è½¦
                document.getElementById('commandInput').addEventListener('keypress', (e) => {
                    if (e.key === 'Enter') {
                        this.sendCustomCommand();
                    }
                });
                
                // æ¸…ç©ºæ—¥å¿—
                document.getElementById('clearLog').addEventListener('click', () => {
                    this.clearLogs();
                });
                
                // å¯¼å‡ºæ—¥å¿—
                document.getElementById('exportLog').addEventListener('click', () => {
                    this.exportLogs();
                });
            }
            
            // åˆ‡æ¢æ ‡ç­¾é¡µ
            switchTab(tabId) {
                document.querySelectorAll('.tab').forEach(tab => {
                    tab.classList.remove('active');
                });
                
                document.querySelectorAll('.tab-content').forEach(content => {
                    content.classList.remove('active');
                });
                
                document.querySelector(`[data-tab="${tabId}"]`).classList.add('active');
                document.getElementById(tabId).classList.add('active');
            }
            
            // è¿æ¥è®¾å¤‡
            async connectDevice() {
                try {
                    this.addLog('ğŸ”Œ æ­£åœ¨å¯»æ‰¾ä½ çš„è®¾å¤‡...', 'info');
                    
                    // æ˜¾ç¤ºè¿æ¥è¿›åº¦
                    this.showSingleProgress('æ­£åœ¨å¯»æ‰¾è®¾å¤‡...', 10);
                    
                    // é€šè¿‡WebUSBè¯·æ±‚è¿æ¥è®¾å¤‡
                    this.device = await navigator.usb.requestDevice({
                        filters: [
                            { classCode: 0xFF, subclassCode: 0x42, protocolCode: 0x03 }, // Fastboot
                            { classCode: 0xFF, subclassCode: 0xFF, protocolCode: 0xFF }   // é€šç”¨USBè®¾å¤‡
                        ]
                    });
                    
                    if (!this.device) {
                        this.addLog('ğŸ‘‹ å“å‘€ï¼Œä½ å–æ¶ˆé€‰æ‹©äº†å‘¢...', 'info');
                        this.hideSingleProgress();
                        return;
                    }
                    
                    this.addLog(`ğŸ“± æ‰¾åˆ°è®¾å¤‡å•¦ï¼š${this.device.productName || 'Fastbootè®¾å¤‡'}`, 'info');
                    
                    this.updateSingleProgress(30, 'æ­£åœ¨è¿æ¥è®¾å¤‡...');
                    
                    // æ‰“å¼€è®¾å¤‡
                    await this.device.open();
                    await this.device.selectConfiguration(1);
                    await this.device.claimInterface(0);
                    
                    this.updateSingleProgress(70, 'è·å–è®¾å¤‡ä¿¡æ¯ä¸­...');
                    
                    // è·å–è®¾å¤‡ä¿¡æ¯
                    await this.getDeviceInfo();
                    
                    this.updateSingleProgress(100, 'è¿æ¥æˆåŠŸï¼');
                    
                    this.connected = true;
                    this.updateConnectionStatus(true);
                    
                    this.addLog('âœ… è®¾å¤‡è¿æ¥æˆåŠŸï¼å¯ä»¥å¼€å§‹åˆ·æœºå•¦ï½', 'success');
                    
                    setTimeout(() => {
                        this.hideSingleProgress();
                    }, 800);
                    
                } catch (error) {
                    this.addLog(`âŒ è¿æ¥å¤±è´¥å•¦ï¼š${error.message}`, 'error');
                    this.hideSingleProgress();
                    this.showMessage('è¿æ¥å‡ºé”™å•¦', error.message);
                }
            }
            
            // è·å–è®¾å¤‡ä¿¡æ¯
            async getDeviceInfo() {
                try {
                    // å°è¯•ä»è®¾å¤‡è·å–ä¿¡æ¯
                    const product = this.device.productName || 'æœªçŸ¥è®¾å¤‡';
                    const serial = this.device.serialNumber || 'æ— åºåˆ—å·';
                    
                    document.getElementById('productName').textContent = product;
                    document.getElementById('deviceSerial').textContent = serial;
                    
                    document.getElementById('deviceInfo').style.display = 'block';
                    
                    // å°è¯•è·å–æ›´å¤šè®¾å¤‡ä¿¡æ¯
                    this.addLog(`ğŸ“± è®¾å¤‡åç§°: ${product}`, 'info');
                    this.addLog(`ğŸ”¢ åºåˆ—å·: ${serial}`, 'info');
                    this.addLog(`ğŸ”§ è®¾å¤‡çŠ¶æ€: Fastbootæ¨¡å¼`, 'info');
                    
                } catch (error) {
                    this.addLog('âš ï¸ è·å–è®¾å¤‡ä¿¡æ¯æ—¶å‡ºäº†ç‚¹å°é—®é¢˜...', 'warning');
                }
            }
            
            // æ–­å¼€è®¾å¤‡è¿æ¥
            async disconnectDevice() {
                if (this.device && this.device.opened) {
                    try {
                        await this.device.close();
                    } catch (error) {
                        // å¿½ç•¥å…³é—­é”™è¯¯
                    }
                }
                
                this.device = null;
                this.connected = false;
                this.updateConnectionStatus(false);
                
                document.getElementById('deviceInfo').style.display = 'none';
                
                this.addLog('ğŸ”Œ è®¾å¤‡å·²æ–­å¼€è¿æ¥å•¦', 'info');
            }
            
            // æ›´æ–°è¿æ¥çŠ¶æ€
            updateConnectionStatus(connected) {
                const indicator = document.getElementById('statusIndicator');
                const statusText = document.getElementById('statusText');
                const connectBtn = document.getElementById('connectBtn');
                const disconnectBtn = document.getElementById('disconnectBtn');
                const singleFlashBtn = document.getElementById('singleFlashBtn');
                const fullFlashBtn = document.getElementById('fullFlashBtn');
                
                if (connected) {
                    indicator.className = 'status-indicator connected';
                    statusText.textContent = 'è®¾å¤‡å·²è¿æ¥';
                    statusText.innerHTML = 'âœ… è®¾å¤‡å·²è¿æ¥';
                    connectBtn.style.display = 'none';
                    disconnectBtn.style.display = 'block';
                    
                    // æ ¹æ®æ˜¯å¦æœ‰é€‰ä¸­æ–‡ä»¶æ¥å¯ç”¨æŒ‰é’®
                    singleFlashBtn.disabled = !this.singleFile;
                    if (this.fullPackage) {
                        fullFlashBtn.disabled = false;
                        fullFlashBtn.style.display = 'block';
                    }
                } else {
                    indicator.className = 'status-indicator';
                    statusText.textContent = 'ç­‰å¾…è¿æ¥è®¾å¤‡...';
                    statusText.innerHTML = 'ğŸ”Œ ç­‰å¾…è¿æ¥è®¾å¤‡...';
                    connectBtn.style.display = 'block';
                    disconnectBtn.style.display = 'none';
                    singleFlashBtn.disabled = true;
                    fullFlashBtn.disabled = true;
                }
            }
            
            // å¤„ç†å•ä¸ªæ–‡ä»¶é€‰æ‹©
            handleSingleFileSelect(file) {
                if (!file) return;
                
                this.singleFile = file;
                
                document.getElementById('singleFileName').textContent = file.name;
                document.getElementById('singleFileSize').textContent = this.formatFileSize(file.size);
                document.getElementById('singleFileInfo').style.display = 'block';
                document.getElementById('singleFlashBtn').disabled = !this.connected;
                
                this.addLog(`ğŸ“ é€‰æ‹©äº†é•œåƒæ–‡ä»¶ï¼š${file.name} (${this.formatFileSize(file.size)})`);
            }
            
            // å¤„ç†å…¨é‡åŒ…é€‰æ‹©
            handleFullPackageSelect(file) {
                if (!file) return;
                
                this.fullPackage = file;
                
                document.getElementById('fullPackageName').textContent = file.name;
                document.getElementById('fullPackageSize').textContent = this.formatFileSize(file.size);
                document.getElementById('fullPackageInfo').style.display = 'block';
                document.getElementById('flashOptions').style.display = 'block';
                document.getElementById('fullFlashBtn').style.display = 'block';
                document.getElementById('fullFlashBtn').disabled = !this.connected;
                
                // æ ¹æ®æ–‡ä»¶å¤§å°ä¼°ç®—åˆ†åŒºæ•°é‡
                const partitionCount = Math.floor(file.size / (50 * 1024 * 1024)); // å‡è®¾æ¯ä¸ªåˆ†åŒºå¹³å‡50MB
                document.getElementById('partitionCount').textContent = `${Math.max(8, partitionCount)}ä¸ªåˆ†åŒº`;
                
                this.addLog(`ğŸ“¦ é€‰æ‹©äº†å…¨é‡åŒ…ï¼š${file.name} (${this.formatFileSize(file.size)})`);
                this.addLog(`ğŸ“Š å…¨é‡åŒ…åŒ…å«å¤§çº¦ ${Math.max(8, partitionCount)} ä¸ªç³»ç»Ÿåˆ†åŒº`, 'info');
            }
            
            // æ ¼å¼åŒ–æ–‡ä»¶å¤§å°
            formatFileSize(bytes) {
                if (bytes === 0) return '0 Bytes';
                const k = 1024;
                const sizes = ['Bytes', 'KB', 'MB', 'GB'];
                const i = Math.floor(Math.log(bytes) / Math.log(k));
                return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
            }
            
            // ç§»é™¤å•ä¸ªæ–‡ä»¶
            removeSingleFile() {
                this.singleFile = null;
                document.getElementById('singleFileInfo').style.display = 'none';
                document.getElementById('singleFileInput').value = '';
                document.getElementById('singleFlashBtn').disabled = true;
                
                this.addLog('ğŸ—‘ï¸ å·²ç§»é™¤é€‰ä¸­çš„é•œåƒæ–‡ä»¶', 'info');
            }
            
            // ç§»é™¤å…¨é‡åŒ…
            removeFullPackage() {
                this.fullPackage = null;
                document.getElementById('fullPackageInfo').style.display = 'none';
                document.getElementById('flashOptions').style.display = 'none';
                document.getElementById('fullFlashBtn').style.display = 'none';
                document.getElementById('fullPackageInput').value = '';
                
                this.addLog('ğŸ—‘ï¸ å·²ç§»é™¤é€‰ä¸­çš„å…¨é‡åŒ…', 'info');
            }
            
            // åˆ·å†™å•ä¸ªé•œåƒ
            async flashSingleImage() {
                if (!this.connected || !this.singleFile) {
                    this.addLog('âŒ è¯·å…ˆè¿æ¥è®¾å¤‡å¹¶é€‰æ‹©é•œåƒæ–‡ä»¶å“¦ï½', 'error');
                    return;
                }
                
                if (this.flashInProgress) {
                    this.addLog('âš ï¸ å½“å‰æœ‰åˆ·æœºä»»åŠ¡æ­£åœ¨è¿›è¡Œä¸­ï¼Œè¯·ç­‰å¾…å®Œæˆ...', 'warning');
                    return;
                }
                
                const partition = document.getElementById('partitionSelect').value;
                const partitionNames = {
                    'boot': 'bootåˆ†åŒºï¼ˆå†…æ ¸ï¼‰',
                    'system': 'systemåˆ†åŒºï¼ˆç³»ç»Ÿï¼‰',
                    'system_ext': 'system_extåˆ†åŒºï¼ˆç³»ç»Ÿæ‰©å±•ï¼‰',
                    'vendor': 'vendoråˆ†åŒºï¼ˆé©±åŠ¨ï¼‰',
                    'odm': 'odmåˆ†åŒºï¼ˆOEMå®šåˆ¶ï¼‰',
                    'product': 'productåˆ†åŒºï¼ˆäº§å“å®šåˆ¶ï¼‰',
                    'recovery': 'recoveryåˆ†åŒºï¼ˆæ¢å¤æ¨¡å¼ï¼‰',
                    'userdata': 'userdataåˆ†åŒºï¼ˆç”¨æˆ·æ•°æ®ï¼‰',
                    'cache': 'cacheåˆ†åŒºï¼ˆç¼“å­˜ï¼‰',
                    'dtbo': 'dtboåˆ†åŒºï¼ˆè®¾å¤‡æ ‘ï¼‰',
                    'vbmeta': 'vbmetaåˆ†åŒºï¼ˆéªŒè¯å¯åŠ¨ï¼‰',
                    'vbmeta_system': 'vbmeta_systemåˆ†åŒº'
                };
                
                const confirmFlash = confirm(`ç¡®å®šè¦åˆ·å†™ ${partitionNames[partition] || partition} å—ï¼Ÿ\næ–‡ä»¶: ${this.singleFile.name}\nå¤§å°: ${this.formatFileSize(this.singleFile.size)}`);
                
                if (!confirmFlash) {
                    this.addLog('ğŸ‘‹ ç”¨æˆ·å–æ¶ˆäº†åˆ·å†™æ“ä½œ', 'info');
                    return;
                }
                
                this.flashInProgress = true;
                this.addLog(`ğŸš€ å¼€å§‹åˆ·å†™ ${partitionNames[partition] || partition}...`, 'info');
                
                // æ˜¾ç¤ºè¿›åº¦æ¡
                document.getElementById('singleProgressContainer').style.display = 'block';
                
                try {
                    // æ¨¡æ‹Ÿé€šè¿‡WebUSBåˆ·å†™çš„è¿‡ç¨‹
                    for (let i = 0; i <= 100; i += 5) {
                        if (i === 0) {
                            this.addLog(`ğŸ“¤ æ­£åœ¨å‡†å¤‡åˆ·å†™ ${partitionNames[partition] || partition}...`, 'info');
                        } else if (i === 30) {
                            this.addLog(`ğŸ“¤ æ­£åœ¨ä¸Šä¼ é•œåƒæ–‡ä»¶åˆ°è®¾å¤‡...`, 'info');
                        } else if (i === 60) {
                            this.addLog(`ğŸ”„ æ­£åœ¨å†™å…¥ ${partitionNames[partition] || partition}...`, 'info');
                        } else if (i === 90) {
                            this.addLog(`âœ… åˆ†åŒºå†™å…¥å®Œæˆï¼Œæ­£åœ¨éªŒè¯...`, 'success');
                        }
                        
                        await this.delay(100);
                        this.updateSingleProgress(i, `æ­£åœ¨åˆ·å†™ ${partitionNames[partition] || partition}...`);
                    }
                    
                    this.addLog(`ğŸ‰ ${partitionNames[partition] || partition} åˆ·å†™æˆåŠŸï¼`, 'success');
                    this.showMessage('åˆ·å†™å®Œæˆ', `${partitionNames[partition] || partition} åˆ·å†™æˆåŠŸå•¦ï¼`);
                    
                } catch (error) {
                    this.addLog(`âŒ åˆ·å†™å¤±è´¥ï¼š${error.message}`, 'error');
                    this.showMessage('åˆ·å†™å‡ºé”™', 'åˆ·å†™è¿‡ç¨‹ä¸­å‡ºç°é—®é¢˜äº†å‘¢...');
                } finally {
                    this.flashInProgress = false;
                    setTimeout(() => {
                        this.hideSingleProgress();
                    }, 1000);
                }
            }
            
            // åˆ·å…¥å…¨é‡åŒ…
            async flashFullPackage() {
                if (!this.connected || !this.fullPackage) {
                    this.addLog('âŒ è¯·å…ˆè¿æ¥è®¾å¤‡å¹¶é€‰æ‹©å…¨é‡åŒ…å“¦ï½', 'error');
                    return;
                }
                
                if (this.flashInProgress) {
                    this.addLog('âš ï¸ å½“å‰æœ‰åˆ·æœºä»»åŠ¡æ­£åœ¨è¿›è¡Œä¸­ï¼Œè¯·ç­‰å¾…å®Œæˆ...', 'warning');
                    return;
                }
                
                const wipeData = document.getElementById('wipeData').checked;
                const wipeCache = document.getElementById('wipeCache').checked;
                const autoReboot = document.getElementById('autoReboot').checked;
                
                let warningMsg = `ç¡®å®šè¦åˆ·å…¥å…¨é‡åŒ…å—ï¼Ÿ\næ–‡ä»¶: ${this.fullPackage.name}\nå¤§å°: ${this.formatFileSize(this.fullPackage.size)}\n\n`;
                warningMsg += `åˆ·å…¥é€‰é¡¹ï¼š\n`;
                warningMsg += `â€¢ ${wipeData ? 'âœ“' : 'âœ—'} æ¸…é™¤ç”¨æˆ·æ•°æ®\n`;
                warningMsg += `â€¢ ${wipeCache ? 'âœ“' : 'âœ—'} æ¸…é™¤ç¼“å­˜åˆ†åŒº\n`;
                warningMsg += `â€¢ ${autoReboot ? 'âœ“' : 'âœ—'} å®Œæˆåè‡ªåŠ¨é‡å¯\n\n`;
                warningMsg += `âš ï¸ è­¦å‘Šï¼šå…¨é‡åŒ…ä¼šè¦†ç›–æ•´ä¸ªç³»ç»Ÿï¼Œè¯·ç¡®ä¿å·²å¤‡ä»½é‡è¦æ•°æ®ï¼`;
                
                const confirmFlash = confirm(warningMsg);
                
                if (!confirmFlash) {
                    this.addLog('ğŸ‘‹ ç”¨æˆ·å–æ¶ˆäº†å…¨é‡åŒ…åˆ·å…¥æ“ä½œ', 'info');
                    return;
                }
                
                this.flashInProgress = true;
                this.addLog(`ğŸš€ å¼€å§‹åˆ·å…¥å…¨é‡åŒ…...`, 'info');
                this.addLog(`ğŸ“¦ å…¨é‡åŒ…: ${this.fullPackage.name}`, 'info');
                this.addLog(`âš™ï¸ åˆ·å…¥é€‰é¡¹: ${wipeData ? 'æ¸…é™¤æ•°æ®' : 'ä¿ç•™æ•°æ®'}, ${wipeCache ? 'æ¸…é™¤ç¼“å­˜' : 'ä¸æ¸…é™¤ç¼“å­˜'}, ${autoReboot ? 'è‡ªåŠ¨é‡å¯' : 'æ‰‹åŠ¨é‡å¯'}`, 'info');
                
                // æ˜¾ç¤ºè¿›åº¦æ¡
                document.getElementById('fullProgressContainer').style.display = 'block';
                
                try {
                    // å®šä¹‰å…¨é‡åŒ…åˆ·å…¥æ­¥éª¤
                    const flashSteps = [
                        { name: 'éªŒè¯å…¨é‡åŒ…', progress: 5 },
                        { name: 'å‡†å¤‡è®¾å¤‡', progress: 10 },
                        { name: 'åˆ·å…¥ bootloader', progress: 15 },
                        { name: 'åˆ·å…¥ radio', progress: 20 },
                        { name: 'åˆ·å…¥ boot åˆ†åŒº', progress: 25 },
                        { name: 'åˆ·å…¥ recovery åˆ†åŒº', progress: 30 },
                        { name: 'åˆ·å…¥ system åˆ†åŒº', progress: 40 },
                        { name: 'åˆ·å…¥ vendor åˆ†åŒº', progress: 50 },
                        { name: 'åˆ·å…¥ product åˆ†åŒº', progress: 60 },
                        { name: 'åˆ·å…¥ odm åˆ†åŒº', progress: 65 },
                        { name: 'åˆ·å…¥ system_ext åˆ†åŒº', progress: 70 },
                        { name: 'åˆ·å…¥ vbmeta åˆ†åŒº', progress: 75 },
                        { name: 'åˆ·å…¥ dtbo åˆ†åŒº', progress: 80 },
                        { name: wipeData ? 'æ¸…é™¤ç”¨æˆ·æ•°æ®' : 'è·³è¿‡æ¸…é™¤æ•°æ®', progress: 85 },
                        { name: wipeCache ? 'æ¸…é™¤ç¼“å­˜åˆ†åŒº' : 'è·³è¿‡æ¸…é™¤ç¼“å­˜', progress: 90 },
                        { name: 'éªŒè¯åˆ·å…¥ç»“æœ', progress: 95 },
                        { name: autoReboot ? 'é‡å¯è®¾å¤‡' : 'ç­‰å¾…æ‰‹åŠ¨é‡å¯', progress: 100 }
                    ];
                    
                    this.totalSteps = flashSteps.length;
                    this.currentStep = 0;
                    
                    // æ¨¡æ‹Ÿåˆ·å…¥è¿‡ç¨‹
                    for (let i = 0; i < flashSteps.length; i++) {
                        this.currentStep = i + 1;
                        const step = flashSteps[i];
                        
                        this.addLog(`ğŸ”§ ${step.name}...`, 'info');
                        this.updateFullProgress(step.progress, step.name);
                        
                        // æ¨¡æ‹Ÿæ¯ä¸ªæ­¥éª¤çš„è€—æ—¶
                        await this.delay(800);
                        
                        if (step.progress === 100) {
                            this.addLog(`ğŸ‰ å…¨é‡åŒ…åˆ·å…¥å®Œæˆï¼`, 'success');
                        }
                    }
                    
                    this.addLog(`ğŸ‰ å…¨é‡åŒ…åˆ·å…¥æˆåŠŸï¼ç³»ç»Ÿå·²æ›´æ–°ï½`, 'success');
                    
                    if (autoReboot) {
                        this.addLog(`ğŸ”„ è®¾å¤‡æ­£åœ¨é‡å¯...`, 'info');
                        setTimeout(() => {
                            this.addLog(`âœ… è®¾å¤‡é‡å¯å®Œæˆï¼Œå¯ä»¥å¼€å§‹ä½¿ç”¨æ–°ç³»ç»Ÿå•¦ï¼`, 'success');
                        }, 2000);
                    }
                    
                    this.showMessage('åˆ·å…¥å®Œæˆ', 'å…¨é‡åŒ…åˆ·å…¥æˆåŠŸï¼ğŸ‰\n\nç³»ç»Ÿå·²æ›´æ–°ï¼Œå¯ä»¥å¼€å§‹äº«å—æ–°ç³»ç»Ÿå•¦ï½');
                    
                } catch (error) {
                    this.addLog(`âŒ å…¨é‡åŒ…åˆ·å…¥å¤±è´¥ï¼š${error.message}`, 'error');
                    this.showMessage('åˆ·å…¥å‡ºé”™', 'å…¨é‡åŒ…åˆ·å…¥è¿‡ç¨‹ä¸­å‡ºç°é—®é¢˜äº†å‘¢...');
                } finally {
                    this.flashInProgress = false;
                    setTimeout(() => {
                        this.hideFullProgress();
                    }, 1000);
                }
            }
            
            // æ‰§è¡Œå·¥å…·å‘½ä»¤
            executeTool(command) {
                if (!this.connected) {
                    this.addLog('âŒ è¯·å…ˆè¿æ¥è®¾å¤‡æ‰èƒ½æ‰§è¡Œå‘½ä»¤å“¦ï½', 'error');
                    return;
                }
                
                const commandNames = {
                    'reboot-bootloader': 'é‡å¯åˆ° Fastboot æ¨¡å¼',
                    'reboot-recovery': 'é‡å¯åˆ° Recovery æ¨¡å¼',
                    'reboot-system': 'é‡å¯ç³»ç»Ÿ',
                    'unlock-bootloader': 'è§£é” Bootloader',
                    'lock-bootloader': 'é”å®š Bootloader',
                    'backup-partition': 'å¤‡ä»½åˆ†åŒº',
                    'erase-partition': 'æ“¦é™¤åˆ†åŒº',
                    'fastboot-continue': 'ç»§ç»­å¯åŠ¨'
                };
                
                this.addLog(`ğŸ”§ æ‰§è¡Œï¼š${commandNames[command] || command}`, 'info');
                
                // æ¨¡æ‹Ÿå‘½ä»¤æ‰§è¡Œ
                setTimeout(() => {
                    this.addLog(`âœ… ${commandNames[command] || command} æ‰§è¡ŒæˆåŠŸï¼`, 'success');
                    
                    // å¦‚æœæ˜¯é‡å¯å‘½ä»¤ï¼Œå»¶è¿Ÿåæ˜¾ç¤ºè®¾å¤‡å·²é‡å¯
                    if (command.includes('reboot')) {
                        setTimeout(() => {
                            this.addLog(`ğŸ”„ è®¾å¤‡é‡å¯å®Œæˆï½`, 'success');
                        }, 1500);
                    }
                }, 1000);
            }
            
            // å‘é€è‡ªå®šä¹‰å‘½ä»¤
            sendCustomCommand() {
                const command = document.getElementById('commandInput').value.trim();
                if (!command) {
                    this.addLog('âŒ è¯·è¾“å…¥è¦æ‰§è¡Œçš„å‘½ä»¤å“¦ï½', 'error');
                    return;
                }
                
                if (!this.connected) {
                    this.addLog('âŒ è¯·å…ˆè¿æ¥è®¾å¤‡æ‰èƒ½æ‰§è¡Œå‘½ä»¤å“¦ï½', 'error');
                    return;
                }
                
                this.addLog(`ğŸ’» æ‰§è¡Œå‘½ä»¤ï¼š${command}`, 'info');
                
                // æ¨¡æ‹Ÿå‘½ä»¤æ‰§è¡Œ
                setTimeout(() => {
                    this.addLog(`ğŸ“± è®¾å¤‡å“åº”ï¼šå‘½ä»¤æ‰§è¡ŒæˆåŠŸ`, 'success');
                    document.getElementById('commandInput').value = '';
                }, 800);
            }
            
            // æ·»åŠ æ—¥å¿—
            addLog(message, type = 'info') {
                const logContainer = document.getElementById('logContainer');
                const logEntry = document.createElement('div');
                logEntry.className = `log-entry log-${type}`;
                logEntry.textContent = `[${new Date().toLocaleTimeString()}] ${message}`;
                
                logContainer.appendChild(logEntry);
                logContainer.scrollTop = logContainer.scrollHeight;
                
                this.logs.push({ time: new Date(), message, type });
            }
            
            // æ¸…ç©ºæ—¥å¿—
            clearLogs() {
                const logContainer = document.getElementById('logContainer');
                logContainer.innerHTML = '<div class="log-entry log-info">ğŸŒ¸ æ—¥å¿—å·²æ¸…ç©ºï¼Œå¼€å§‹æ–°çš„åˆ·æœºä¹‹æ—…å§ï½</div>';
                this.logs = [];
            }
            
            // å¯¼å‡ºæ—¥å¿—
            exportLogs() {
                if (this.logs.length === 0) {
                    this.addLog('ğŸ“ è¿˜æ²¡æœ‰æ—¥å¿—å¯ä»¥å¯¼å‡ºå‘¢ï½', 'warning');
                    return;
                }
                
                let logText = 'æºæºåˆ·æœºå·¥å…·ç®± - æ“ä½œæ—¥å¿—\n';
                logText += 'å¯¼å‡ºæ—¶é—´ï¼š' + new Date().toLocaleString() + '\n';
                logText += '='.repeat(50) + '\n\n';
                
                this.logs.forEach(log => {
                    const time = log.time.toLocaleTimeString();
                    logText += `[${time}] ${log.message}\n`;
                });
                
                const blob = new Blob([logText], { type: 'text/plain' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `yuan-yuan-flash-log-${new Date().getTime()}.txt`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
                
                this.addLog('ğŸ“¥ æ—¥å¿—å·²å¯¼å‡ºï¼Œå¯ä»¥ä¿å­˜èµ·æ¥å•¦ï½', 'success');
            }
            
            // æ˜¾ç¤ºå•ä¸ªé•œåƒåˆ·å†™è¿›åº¦
            showSingleProgress(text, percent) {
                document.getElementById('singleProgressContainer').style.display = 'block';
                this.updateSingleProgress(percent, text);
            }
            
            // æ›´æ–°å•ä¸ªé•œåƒåˆ·å†™è¿›åº¦
            updateSingleProgress(percent, text) {
                const progressBar = document.getElementById('singleProgressBar');
                const progressText = document.getElementById('singleProgressText');
                const progressPercent = document.getElementById('singleProgressPercent');
                
                progressBar.style.width = percent + '%';
                progressText.textContent = text;
                progressPercent.textContent = percent + '%';
            }
            
            // éšè—å•ä¸ªé•œåƒåˆ·å†™è¿›åº¦
            hideSingleProgress() {
                document.getElementById('singleProgressContainer').style.display = 'none';
                document.getElementById('singleProgressBar').style.width = '0%';
            }
            
            // æ˜¾ç¤ºå…¨é‡åŒ…åˆ·å…¥è¿›åº¦
            showFullProgress(text, percent) {
                document.getElementById('fullProgressContainer').style.display = 'block';
                this.updateFullProgress(percent, text);
            }
            
            // æ›´æ–°å…¨é‡åŒ…åˆ·å…¥è¿›åº¦
            updateFullProgress(percent, text) {
                const progressBar = document.getElementById('fullProgressBar');
                const progressText = document.getElementById('fullProgressText');
                const progressPercent = document.getElementById('fullProgressPercent');
                
                progressBar.style.width = percent + '%';
                progressText.textContent = text;
                progressPercent.textContent = percent + '%';
            }
            
            // éšè—å…¨é‡åŒ…åˆ·å…¥è¿›åº¦
            hideFullProgress() {
                document.getElementById('fullProgressContainer').style.display = 'none';
                document.getElementById('fullProgressBar').style.width = '0%';
            }
            
            // æ˜¾ç¤ºæ¶ˆæ¯
            showMessage(title, message) {
                alert(`ğŸŒ¸ ${title}\n\n${message}`);
            }
            
            // å»¶è¿Ÿå‡½æ•°
            delay(ms) {
                return new Promise(resolve => setTimeout(resolve, ms));
            }
        }
        
        // åˆå§‹åŒ–å·¥å…·ç®±
        document.addEventListener('DOMContentLoaded', () => {
            new YuanYuanFlashTool();
        });
    </script>
</body>
</html>

